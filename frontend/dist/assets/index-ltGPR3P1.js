import{N as In,O as jn,R as Nn,Q as Wn,V as zn,W as Tt,Y as Vn,Z as Kr,$ as ar,a0 as Hn,a1 as Xr,a2 as Xn,a3 as Yn,a4 as bn,a5 as Kn,a6 as Jn,a7 as en,a8 as Qn,a9 as rn,aa as Zn,ab as Ft,r as Se,ac as qn,ad as $n,ae as ea,af as cr,ag as ra,j as X,ah as ta,ai as na,aj as Jr,ak as aa,al as oa,am as ia,t as sa,an as la}from"./index-B_M3mWkz.js";import{R as hr,u as fa,C as ua,c as ca,s as ha,a as nr,b as da,P as va,K as pa}from"./react-three-rapier.esm-TN9xN3ZX.js";import{u as ga}from"./useMutation-BCC8QTzN.js";function ma(){var f=Object.create(null);function t(r,e){var a=r.id,i=r.name,n=r.dependencies;n===void 0&&(n=[]);var o=r.init;o===void 0&&(o=function(){});var s=r.getTransferables;if(s===void 0&&(s=null),!f[a])try{n=n.map(function(u){return u&&u.isWorkerModule&&(t(u,function(c){if(c instanceof Error)throw c}),u=f[u.id].value),u}),o=h("<"+i+">.init",o),s&&(s=h("<"+i+">.getTransferables",s));var l=null;typeof o=="function"?l=o.apply(void 0,n):console.error("worker module init function failed to rehydrate"),f[a]={id:a,value:l,getTransferables:s},e(l)}catch(u){u&&u.noLog||console.error(u),e(u)}}function d(r,e){var a,i=r.id,n=r.args;(!f[i]||typeof f[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var o=(a=f[i]).value.apply(a,n);o&&typeof o.then=="function"?o.then(s,function(l){return e(l instanceof Error?l:new Error(""+l))}):s(o)}catch(l){e(l)}function s(l){try{var u=f[i].getTransferables&&f[i].getTransferables(l);(!u||!Array.isArray(u)||!u.length)&&(u=void 0),e(l,u)}catch(c){console.error(c),e(c)}}}function h(r,e){var a=void 0;self.troikaDefine=function(n){return a=n};var i=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(n){console.error(n)}return URL.revokeObjectURL(i),delete self.troikaDefine,a}self.addEventListener("message",function(r){var e=r.data,a=e.messageId,i=e.action,n=e.data;try{i==="registerModule"&&t(n,function(o){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof o=="function"}})}),i==="callModule"&&d(n,function(o,s){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:o},s||void 0)})}catch(o){postMessage({messageId:a,success:!1,error:o.stack})}})}function ya(f){var t=function(){for(var d=[],h=arguments.length;h--;)d[h]=arguments[h];return t._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,d);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var d=f.dependencies,h=f.init;d=Array.isArray(d)?d.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var r=Promise.all(d).then(function(e){return h.apply(null,e)});return t._getInitResult=function(){return r},r},t}var xn=function(){var f=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),f=!0}catch(d){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+d.message+"]")}return xn=function(){return f},f},ba=0,xa=0,mt=!1,Tr=Object.create(null),Fr=Object.create(null),St=Object.create(null);function dr(f){if((!f||typeof f.init!="function")&&!mt)throw new Error("requires `options.init` function");var t=f.dependencies,d=f.init,h=f.getTransferables,r=f.workerId,e=ya(f);r==null&&(r="#default");var a="workerModule"+ ++ba,i=f.name||a,n=null;t=t&&t.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(mt=!0,s=dr({workerId:r,name:"<"+i+"> function dependency: "+s.name,init:`function(){return (
`+zr(s)+`
)}`}),mt=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function o(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];if(!xn())return e.apply(void 0,s);if(!n){n=tn(r,"registerModule",o.workerModuleData);var u=function(){n=null,Fr[r].delete(u)};(Fr[r]||(Fr[r]=new Set)).add(u)}return n.then(function(c){var g=c.isCallable;if(g)return tn(r,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return o.workerModuleData={isWorkerModule:!0,id:a,name:i,dependencies:t,init:zr(d),getTransferables:h&&zr(h)},o.onMainThread=e,o}function wa(f){Fr[f]&&Fr[f].forEach(function(t){t()}),Tr[f]&&(Tr[f].terminate(),delete Tr[f])}function zr(f){var t=f.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function Sa(f){var t=Tr[f];if(!t){var d=zr(ma);t=Tr[f]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+f.replace(/\*/g,"")+` **/

;(`+d+")()"],{type:"application/javascript"}))),t.onmessage=function(h){var r=h.data,e=r.messageId,a=St[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete St[e],a(r)}}return t}function tn(f,t,d){return new Promise(function(h,r){var e=++xa;St[e]=function(a){a.success?h(a.result):r(new Error("Error in worker "+t+" call: "+a.error))},Sa(f).postMessage({messageId:e,action:t,data:d})})}function wn(){var f=function(t){function d(P,L,v,x,F,A,U,j){var M=1-U;j.x=M*M*P+2*M*U*v+U*U*F,j.y=M*M*L+2*M*U*x+U*U*A}function h(P,L,v,x,F,A,U,j,M,I){var K=1-M;I.x=K*K*K*P+3*K*K*M*v+3*K*M*M*F+M*M*M*U,I.y=K*K*K*L+3*K*K*M*x+3*K*M*M*A+M*M*M*j}function r(P,L){for(var v=/([MLQCZ])([^MLQCZ]*)/g,x,F,A,U,j;x=v.exec(P);){var M=x[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(I){return parseFloat(I)});switch(x[1]){case"M":U=F=M[0],j=A=M[1];break;case"L":(M[0]!==U||M[1]!==j)&&L("L",U,j,U=M[0],j=M[1]);break;case"Q":{L("Q",U,j,U=M[2],j=M[3],M[0],M[1]);break}case"C":{L("C",U,j,U=M[4],j=M[5],M[0],M[1],M[2],M[3]);break}case"Z":(U!==F||j!==A)&&L("L",U,j,F,A);break}}}function e(P,L,v){v===void 0&&(v=16);var x={x:0,y:0};r(P,function(F,A,U,j,M,I,K,ee,V){switch(F){case"L":L(A,U,j,M);break;case"Q":{for(var N=A,ge=U,ce=1;ce<v;ce++)d(A,U,I,K,j,M,ce/(v-1),x),L(N,ge,x.x,x.y),N=x.x,ge=x.y;break}case"C":{for(var Z=A,re=U,le=1;le<v;le++)h(A,U,I,K,ee,V,j,M,le/(v-1),x),L(Z,re,x.x,x.y),Z=x.x,re=x.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(P,L){var v=P.getContext?P.getContext("webgl",o):P,x=n.get(v);if(!x){let K=function(Z){var re=A[Z];if(!re&&(re=A[Z]=v.getExtension(Z),!re))throw new Error(Z+" not supported");return re},ee=function(Z,re){var le=v.createShader(re);return v.shaderSource(le,Z),v.compileShader(le),le},V=function(Z,re,le,z){if(!U[Z]){var te={},$={},O=v.createProgram();v.attachShader(O,ee(re,v.VERTEX_SHADER)),v.attachShader(O,ee(le,v.FRAGMENT_SHADER)),v.linkProgram(O),U[Z]={program:O,transaction:function(Q){v.useProgram(O),Q({setUniform:function(J,xe){for(var ae=[],ie=arguments.length-2;ie-- >0;)ae[ie]=arguments[ie+2];var ue=$[xe]||($[xe]=v.getUniformLocation(O,xe));v["uniform"+J].apply(v,[ue].concat(ae))},setAttribute:function(J,xe,ae,ie,ue){var ve=te[J];ve||(ve=te[J]={buf:v.createBuffer(),loc:v.getAttribLocation(O,J),data:null}),v.bindBuffer(v.ARRAY_BUFFER,ve.buf),v.vertexAttribPointer(ve.loc,xe,v.FLOAT,!1,0,0),v.enableVertexAttribArray(ve.loc),F?v.vertexAttribDivisor(ve.loc,ie):K("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ve.loc,ie),ue!==ve.data&&(v.bufferData(v.ARRAY_BUFFER,ue,ae),ve.data=ue)}})}}}U[Z].transaction(z)},N=function(Z,re){M++;try{v.activeTexture(v.TEXTURE0+M);var le=j[Z];le||(le=j[Z]=v.createTexture(),v.bindTexture(v.TEXTURE_2D,le),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.bindTexture(v.TEXTURE_2D,le),re(le,M)}finally{M--}},ge=function(Z,re,le){var z=v.createFramebuffer();I.push(z),v.bindFramebuffer(v.FRAMEBUFFER,z),v.activeTexture(v.TEXTURE0+re),v.bindTexture(v.TEXTURE_2D,Z),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,Z,0);try{le(z)}finally{v.deleteFramebuffer(z),v.bindFramebuffer(v.FRAMEBUFFER,I[--I.length-1]||null)}},ce=function(){A={},U={},j={},M=-1,I.length=0};var F=typeof WebGL2RenderingContext<"u"&&v instanceof WebGL2RenderingContext,A={},U={},j={},M=-1,I=[];v.canvas.addEventListener("webglcontextlost",function(Z){ce(),Z.preventDefault()},!1),n.set(v,x={gl:v,isWebGL2:F,getExtension:K,withProgram:V,withTexture:N,withTextureFramebuffer:ge,handleContextLoss:ce})}L(x)}function l(P,L,v,x,F,A,U,j){U===void 0&&(U=15),j===void 0&&(j=null),s(P,function(M){var I=M.gl,K=M.withProgram,ee=M.withTexture;ee("copy",function(V,N){I.texImage2D(I.TEXTURE_2D,0,I.RGBA,F,A,0,I.RGBA,I.UNSIGNED_BYTE,L),K("copy",a,i,function(ge){var ce=ge.setUniform,Z=ge.setAttribute;Z("aUV",2,I.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ce("1i","image",N),I.bindFramebuffer(I.FRAMEBUFFER,j||null),I.disable(I.BLEND),I.colorMask(U&8,U&4,U&2,U&1),I.viewport(v,x,F,A),I.scissor(v,x,F,A),I.drawArrays(I.TRIANGLES,0,3)})})})}function u(P,L,v){var x=P.width,F=P.height;s(P,function(A){var U=A.gl,j=new Uint8Array(x*F*4);U.readPixels(0,0,x,F,U.RGBA,U.UNSIGNED_BYTE,j),P.width=L,P.height=v,l(U,j,0,0,x,F)})}var c=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:l,resizeWebGLCanvasWithoutClearing:u});function g(P,L,v,x,F,A){A===void 0&&(A=1);var U=new Uint8Array(P*L),j=x[2]-x[0],M=x[3]-x[1],I=[];e(v,function(Z,re,le,z){I.push({x1:Z,y1:re,x2:le,y2:z,minX:Math.min(Z,le),minY:Math.min(re,z),maxX:Math.max(Z,le),maxY:Math.max(re,z)})}),I.sort(function(Z,re){return Z.maxX-re.maxX});for(var K=0;K<P;K++)for(var ee=0;ee<L;ee++){var V=ge(x[0]+j*(K+.5)/P,x[1]+M*(ee+.5)/L),N=Math.pow(1-Math.abs(V)/F,A)/2;V<0&&(N=1-N),N=Math.max(0,Math.min(255,Math.round(N*255))),U[ee*P+K]=N}return U;function ge(Z,re){for(var le=1/0,z=1/0,te=I.length;te--;){var $=I[te];if($.maxX+z<=Z)break;if(Z+z>$.minX&&re-z<$.maxY&&re+z>$.minY){var O=G(Z,re,$.x1,$.y1,$.x2,$.y2);O<le&&(le=O,z=Math.sqrt(le))}}return ce(Z,re)&&(z=-z),z}function ce(Z,re){for(var le=0,z=I.length;z--;){var te=I[z];if(te.maxX<=Z)break;var $=te.y1>re!=te.y2>re&&Z<(te.x2-te.x1)*(re-te.y1)/(te.y2-te.y1)+te.x1;$&&(le+=te.y1<te.y2?1:-1)}return le!==0}}function p(P,L,v,x,F,A,U,j,M,I){A===void 0&&(A=1),j===void 0&&(j=0),M===void 0&&(M=0),I===void 0&&(I=0),m(P,L,v,x,F,A,U,null,j,M,I)}function m(P,L,v,x,F,A,U,j,M,I,K){A===void 0&&(A=1),M===void 0&&(M=0),I===void 0&&(I=0),K===void 0&&(K=0);for(var ee=g(P,L,v,x,F,A),V=new Uint8Array(ee.length*4),N=0;N<ee.length;N++)V[N*4+K]=ee[N];l(U,V,M,I,P,L,1<<3-K,j)}function G(P,L,v,x,F,A){var U=F-v,j=A-x,M=U*U+j*j,I=M?Math.max(0,Math.min(1,((P-v)*U+(L-x)*j)/M)):0,K=P-(v+I*U),ee=L-(x+I*j);return K*K+ee*ee}var S=Object.freeze({__proto__:null,generate:g,generateIntoCanvas:p,generateIntoFramebuffer:m}),T="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",y="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",k="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",R=new Float32Array([0,0,2,0,0,2]),w=null,_=!1,B={},D=new WeakMap;function Y(P){if(!_&&!H(P))throw new Error("WebGL generation not supported")}function b(P,L,v,x,F,A,U){if(A===void 0&&(A=1),U===void 0&&(U=null),!U&&(U=w,!U)){var j=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!j)throw new Error("OffscreenCanvas or DOM canvas not supported");U=w=j.getContext("webgl",{depth:!1})}Y(U);var M=new Uint8Array(P*L*4);s(U,function(V){var N=V.gl,ge=V.withTexture,ce=V.withTextureFramebuffer;ge("readable",function(Z,re){N.texImage2D(N.TEXTURE_2D,0,N.RGBA,P,L,0,N.RGBA,N.UNSIGNED_BYTE,null),ce(Z,re,function(le){C(P,L,v,x,F,A,N,le,0,0,0),N.readPixels(0,0,P,L,N.RGBA,N.UNSIGNED_BYTE,M)})})});for(var I=new Uint8Array(P*L),K=0,ee=0;K<M.length;K+=4)I[ee++]=M[K];return I}function E(P,L,v,x,F,A,U,j,M,I){A===void 0&&(A=1),j===void 0&&(j=0),M===void 0&&(M=0),I===void 0&&(I=0),C(P,L,v,x,F,A,U,null,j,M,I)}function C(P,L,v,x,F,A,U,j,M,I,K){A===void 0&&(A=1),M===void 0&&(M=0),I===void 0&&(I=0),K===void 0&&(K=0),Y(U);var ee=[];e(v,function(V,N,ge,ce){ee.push(V,N,ge,ce)}),ee=new Float32Array(ee),s(U,function(V){var N=V.gl,ge=V.isWebGL2,ce=V.getExtension,Z=V.withProgram,re=V.withTexture,le=V.withTextureFramebuffer,z=V.handleContextLoss;if(re("rawDistances",function(te,$){(P!==te._lastWidth||L!==te._lastHeight)&&N.texImage2D(N.TEXTURE_2D,0,N.RGBA,te._lastWidth=P,te._lastHeight=L,0,N.RGBA,N.UNSIGNED_BYTE,null),Z("main",T,y,function(O){var de=O.setAttribute,Q=O.setUniform,oe=!ge&&ce("ANGLE_instanced_arrays"),J=!ge&&ce("EXT_blend_minmax");de("aUV",2,N.STATIC_DRAW,0,R),de("aLineSegment",4,N.DYNAMIC_DRAW,1,ee),Q.apply(void 0,["4f","uGlyphBounds"].concat(x)),Q("1f","uMaxDistance",F),Q("1f","uExponent",A),le(te,$,function(xe){N.enable(N.BLEND),N.colorMask(!0,!0,!0,!0),N.viewport(0,0,P,L),N.scissor(0,0,P,L),N.blendFunc(N.ONE,N.ONE),N.blendEquationSeparate(N.FUNC_ADD,ge?N.MAX:J.MAX_EXT),N.clear(N.COLOR_BUFFER_BIT),ge?N.drawArraysInstanced(N.TRIANGLES,0,3,ee.length/4):oe.drawArraysInstancedANGLE(N.TRIANGLES,0,3,ee.length/4)})}),Z("post",a,k,function(O){O.setAttribute("aUV",2,N.STATIC_DRAW,0,R),O.setUniform("1i","tex",$),N.bindFramebuffer(N.FRAMEBUFFER,j),N.disable(N.BLEND),N.colorMask(K===0,K===1,K===2,K===3),N.viewport(M,I,P,L),N.scissor(M,I,P,L),N.drawArrays(N.TRIANGLES,0,3)})}),N.isContextLost())throw z(),new Error("webgl context lost")})}function H(P){var L=!P||P===w?B:P.canvas||P,v=D.get(L);if(v===void 0){_=!0;var x=null;try{var F=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],A=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,P);v=A&&F.length===A.length&&A.every(function(U,j){return U===F[j]}),v||(x="bad trial run results",console.info(F,A))}catch(U){v=!1,x=U.message}x&&console.warn("WebGL SDF generation not supported:",x),_=!1,D.set(L,v)}return v}var W=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:E,generateIntoFramebuffer:C,isSupported:H});function q(P,L,v,x,F,A){F===void 0&&(F=Math.max(x[2]-x[0],x[3]-x[1])/2),A===void 0&&(A=1);try{return b.apply(W,arguments)}catch(U){return console.info("WebGL SDF generation failed, falling back to JS",U),g.apply(S,arguments)}}function ne(P,L,v,x,F,A,U,j,M,I){F===void 0&&(F=Math.max(x[2]-x[0],x[3]-x[1])/2),A===void 0&&(A=1),j===void 0&&(j=0),M===void 0&&(M=0),I===void 0&&(I=0);try{return E.apply(W,arguments)}catch(K){return console.info("WebGL SDF generation failed, falling back to JS",K),p.apply(S,arguments)}}return t.forEachPathCommand=r,t.generate=q,t.generateIntoCanvas=ne,t.javascript=S,t.pathToLineSegments=e,t.webgl=W,t.webglUtils=c,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return f}function Ua(){var f=function(t){var d={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},h={},r={};h.L=1,r[1]="L",Object.keys(d).forEach(function(z,te){h[z]=1<<te+1,r[h[z]]=z}),Object.freeze(h);var e=h.LRI|h.RLI|h.FSI,a=h.L|h.R|h.AL,i=h.B|h.S|h.WS|h.ON|h.FSI|h.LRI|h.RLI|h.PDI,n=h.BN|h.RLE|h.LRE|h.RLO|h.LRO|h.PDF,o=h.S|h.WS|h.B|e|h.PDI|n,s=null;function l(){if(!s){s=new Map;var z=function($){if(d.hasOwnProperty($)){var O=0;d[$].split(",").forEach(function(de){var Q=de.split("+"),oe=Q[0],J=Q[1];oe=parseInt(oe,36),J=J?parseInt(J,36):0,s.set(O+=oe,h[$]);for(var xe=0;xe<J;xe++)s.set(++O,h[$])})}};for(var te in d)z(te)}}function u(z){return l(),s.get(z.codePointAt(0))||h.L}function c(z){return r[u(z)]}var g={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function p(z,te){var $=36,O=0,de=new Map,Q=te&&new Map,oe;return z.split(",").forEach(function J(xe){if(xe.indexOf("+")!==-1)for(var ae=+xe;ae--;)J(oe);else{oe=xe;var ie=xe.split(">"),ue=ie[0],ve=ie[1];ue=String.fromCodePoint(O+=parseInt(ue,$)),ve=String.fromCodePoint(O+=parseInt(ve,$)),de.set(ue,ve),te&&Q.set(ve,ue)}}),{map:de,reverseMap:Q}}var m,G,S;function T(){if(!m){var z=p(g.pairs,!0),te=z.map,$=z.reverseMap;m=te,G=$,S=p(g.canonical,!1).map}}function y(z){return T(),m.get(z)||null}function k(z){return T(),G.get(z)||null}function R(z){return T(),S.get(z)||null}var w=h.L,_=h.R,B=h.EN,D=h.ES,Y=h.ET,b=h.AN,E=h.CS,C=h.B,H=h.S,W=h.ON,q=h.BN,ne=h.NSM,P=h.AL,L=h.LRO,v=h.RLO,x=h.LRE,F=h.RLE,A=h.PDF,U=h.LRI,j=h.RLI,M=h.FSI,I=h.PDI;function K(z,te){for(var $=125,O=new Uint32Array(z.length),de=0;de<z.length;de++)O[de]=u(z[de]);var Q=new Map;function oe(Pe,Ve){var Ie=O[Pe];O[Pe]=Ve,Q.set(Ie,Q.get(Ie)-1),Ie&i&&Q.set(i,Q.get(i)-1),Q.set(Ve,(Q.get(Ve)||0)+1),Ve&i&&Q.set(i,(Q.get(i)||0)+1)}for(var J=new Uint8Array(z.length),xe=new Map,ae=[],ie=null,ue=0;ue<z.length;ue++)ie||ae.push(ie={start:ue,end:z.length-1,level:te==="rtl"?1:te==="ltr"?0:qt(ue,!1)}),O[ue]&C&&(ie.end=ue,ie=null);for(var ve=F|x|v|L|e|I|A|C,ke=function(Pe){return Pe+(Pe&1?1:2)},Ae=function(Pe){return Pe+(Pe&1?2:1)},me=0;me<ae.length;me++){ie=ae[me];var ye=[{_level:ie.level,_override:0,_isolate:0}],fe=void 0,De=0,Te=0,Be=0;Q.clear();for(var _e=ie.start;_e<=ie.end;_e++){var he=O[_e];if(fe=ye[ye.length-1],Q.set(he,(Q.get(he)||0)+1),he&i&&Q.set(i,(Q.get(i)||0)+1),he&ve)if(he&(F|x)){J[_e]=fe._level;var we=(he===F?Ae:ke)(fe._level);we<=$&&!De&&!Te?ye.push({_level:we,_override:0,_isolate:0}):De||Te++}else if(he&(v|L)){J[_e]=fe._level;var Je=(he===v?Ae:ke)(fe._level);Je<=$&&!De&&!Te?ye.push({_level:Je,_override:he&v?_:w,_isolate:0}):De||Te++}else if(he&e){he&M&&(he=qt(_e+1,!0)===1?j:U),J[_e]=fe._level,fe._override&&oe(_e,fe._override);var Ue=(he===j?Ae:ke)(fe._level);Ue<=$&&De===0&&Te===0?(Be++,ye.push({_level:Ue,_override:0,_isolate:1,_isolInitIndex:_e})):De++}else if(he&I){if(De>0)De--;else if(Be>0){for(Te=0;!ye[ye.length-1]._isolate;)ye.pop();var be=ye[ye.length-1]._isolInitIndex;be!=null&&(xe.set(be,_e),xe.set(_e,be)),ye.pop(),Be--}fe=ye[ye.length-1],J[_e]=fe._level,fe._override&&oe(_e,fe._override)}else he&A?(De===0&&(Te>0?Te--:!fe._isolate&&ye.length>1&&(ye.pop(),fe=ye[ye.length-1])),J[_e]=fe._level):he&C&&(J[_e]=ie.level);else J[_e]=fe._level,fe._override&&he!==q&&oe(_e,fe._override)}for(var Ee=[],Fe=null,pe=ie.start;pe<=ie.end;pe++){var Ce=O[pe];if(!(Ce&n)){var Le=J[pe],Ge=Ce&e,Me=Ce===I;Fe&&Le===Fe._level?(Fe._end=pe,Fe._endsWithIsolInit=Ge):Ee.push(Fe={_start:pe,_end:pe,_level:Le,_startsWithPDI:Me,_endsWithIsolInit:Ge})}}for(var We=[],Qe=0;Qe<Ee.length;Qe++){var Ye=Ee[Qe];if(!Ye._startsWithPDI||Ye._startsWithPDI&&!xe.has(Ye._start)){for(var Ze=[Fe=Ye],er=void 0;Fe&&Fe._endsWithIsolInit&&(er=xe.get(Fe._end))!=null;)for(var Ke=Qe+1;Ke<Ee.length;Ke++)if(Ee[Ke]._start===er){Ze.push(Fe=Ee[Ke]);break}for(var Oe=[],rr=0;rr<Ze.length;rr++)for(var Mt=Ze[rr],Zr=Mt._start;Zr<=Mt._end;Zr++)Oe.push(Zr);for(var Rn=J[Oe[0]],Rt=ie.level,Cr=Oe[0]-1;Cr>=0;Cr--)if(!(O[Cr]&n)){Rt=J[Cr];break}var qr=Oe[Oe.length-1],Gn=J[qr],Gt=ie.level;if(!(O[qr]&e)){for(var Ar=qr+1;Ar<=ie.end;Ar++)if(!(O[Ar]&n)){Gt=J[Ar];break}}We.push({_seqIndices:Oe,_sosType:Math.max(Rt,Rn)%2?_:w,_eosType:Math.max(Gt,Gn)%2?_:w})}}for(var $r=0;$r<We.length;$r++){var et=We[$r],se=et._seqIndices,vr=et._sosType,Ln=et._eosType,ir=J[se[0]]&1?_:w;if(Q.get(ne))for(var Dr=0;Dr<se.length;Dr++){var Lt=se[Dr];if(O[Lt]&ne){for(var rt=vr,Er=Dr-1;Er>=0;Er--)if(!(O[se[Er]]&n)){rt=O[se[Er]];break}oe(Lt,rt&(e|I)?W:rt)}}if(Q.get(B))for(var Mr=0;Mr<se.length;Mr++){var Ot=se[Mr];if(O[Ot]&B)for(var Rr=Mr-1;Rr>=-1;Rr--){var Bt=Rr===-1?vr:O[se[Rr]];if(Bt&a){Bt===P&&oe(Ot,b);break}}}if(Q.get(P))for(var tt=0;tt<se.length;tt++){var Pt=se[tt];O[Pt]&P&&oe(Pt,_)}if(Q.get(D)||Q.get(E))for(var pr=1;pr<se.length-1;pr++){var nt=se[pr];if(O[nt]&(D|E)){for(var sr=0,at=0,ot=pr-1;ot>=0&&(sr=O[se[ot]],!!(sr&n));ot--);for(var it=pr+1;it<se.length&&(at=O[se[it]],!!(at&n));it++);sr===at&&(O[nt]===D?sr===B:sr&(B|b))&&oe(nt,sr)}}if(Q.get(B))for(var Xe=0;Xe<se.length;Xe++){var On=se[Xe];if(O[On]&B){for(var Gr=Xe-1;Gr>=0&&O[se[Gr]]&(Y|n);Gr--)oe(se[Gr],B);for(Xe++;Xe<se.length&&O[se[Xe]]&(Y|n|B);Xe++)O[se[Xe]]!==B&&oe(se[Xe],B)}}if(Q.get(Y)||Q.get(D)||Q.get(E))for(var gr=0;gr<se.length;gr++){var It=se[gr];if(O[It]&(Y|D|E)){oe(It,W);for(var Lr=gr-1;Lr>=0&&O[se[Lr]]&n;Lr--)oe(se[Lr],W);for(var Or=gr+1;Or<se.length&&O[se[Or]]&n;Or++)oe(se[Or],W)}}if(Q.get(B))for(var st=0,jt=vr;st<se.length;st++){var Nt=se[st],lt=O[Nt];lt&B?jt===w&&oe(Nt,w):lt&a&&(jt=lt)}if(Q.get(i)){var mr=_|B|b,Wt=mr|w,Br=[];{for(var lr=[],fr=0;fr<se.length;fr++)if(O[se[fr]]&i){var yr=z[se[fr]],zt=void 0;if(y(yr)!==null)if(lr.length<63)lr.push({char:yr,seqIndex:fr});else break;else if((zt=k(yr))!==null)for(var br=lr.length-1;br>=0;br--){var ft=lr[br].char;if(ft===zt||ft===k(R(yr))||y(R(ft))===yr){Br.push([lr[br].seqIndex,fr]),lr.length=br;break}}}Br.sort(function(Pe,Ve){return Pe[0]-Ve[0]})}for(var ut=0;ut<Br.length;ut++){for(var Vt=Br[ut],Pr=Vt[0],ct=Vt[1],Ht=!1,ze=0,ht=Pr+1;ht<ct;ht++){var Xt=se[ht];if(O[Xt]&Wt){Ht=!0;var Yt=O[Xt]&mr?_:w;if(Yt===ir){ze=Yt;break}}}if(Ht&&!ze){ze=vr;for(var dt=Pr-1;dt>=0;dt--){var Kt=se[dt];if(O[Kt]&Wt){var Jt=O[Kt]&mr?_:w;Jt!==ir?ze=Jt:ze=ir;break}}}if(ze){if(O[se[Pr]]=O[se[ct]]=ze,ze!==ir){for(var xr=Pr+1;xr<se.length;xr++)if(!(O[se[xr]]&n)){u(z[se[xr]])&ne&&(O[se[xr]]=ze);break}}if(ze!==ir){for(var wr=ct+1;wr<se.length;wr++)if(!(O[se[wr]]&n)){u(z[se[wr]])&ne&&(O[se[wr]]=ze);break}}}}for(var qe=0;qe<se.length;qe++)if(O[se[qe]]&i){for(var Qt=qe,vt=qe,pt=vr,Sr=qe-1;Sr>=0;Sr--)if(O[se[Sr]]&n)Qt=Sr;else{pt=O[se[Sr]]&mr?_:w;break}for(var Zt=Ln,Ur=qe+1;Ur<se.length;Ur++)if(O[se[Ur]]&(i|n))vt=Ur;else{Zt=O[se[Ur]]&mr?_:w;break}for(var gt=Qt;gt<=vt;gt++)O[se[gt]]=pt===Zt?pt:ir;qe=vt}}}for(var je=ie.start;je<=ie.end;je++){var Bn=J[je],Ir=O[je];if(Bn&1?Ir&(w|B|b)&&J[je]++:Ir&_?J[je]++:Ir&(b|B)&&(J[je]+=2),Ir&n&&(J[je]=je===0?ie.level:J[je-1]),je===ie.end||u(z[je])&(H|C))for(var jr=je;jr>=0&&u(z[jr])&o;jr--)J[jr]=ie.level}}return{levels:J,paragraphs:ae};function qt(Pe,Ve){for(var Ie=Pe;Ie<z.length;Ie++){var $e=O[Ie];if($e&(_|P))return 1;if($e&(C|w)||Ve&&$e===I)return 0;if($e&e){var $t=Pn(Ie);Ie=$t===-1?z.length:$t}}return 0}function Pn(Pe){for(var Ve=1,Ie=Pe+1;Ie<z.length;Ie++){var $e=O[Ie];if($e&C)break;if($e&I){if(--Ve===0)return Ie}else $e&e&&Ve++}return-1}}var ee="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",V;function N(){if(!V){var z=p(ee,!0),te=z.map,$=z.reverseMap;$.forEach(function(O,de){te.set(de,O)}),V=te}}function ge(z){return N(),V.get(z)||null}function ce(z,te,$,O){var de=z.length;$=Math.max(0,$==null?0:+$),O=Math.min(de-1,O==null?de-1:+O);for(var Q=new Map,oe=$;oe<=O;oe++)if(te[oe]&1){var J=ge(z[oe]);J!==null&&Q.set(oe,J)}return Q}function Z(z,te,$,O){var de=z.length;$=Math.max(0,$==null?0:+$),O=Math.min(de-1,O==null?de-1:+O);var Q=[];return te.paragraphs.forEach(function(oe){var J=Math.max($,oe.start),xe=Math.min(O,oe.end);if(J<xe){for(var ae=te.levels.slice(J,xe+1),ie=xe;ie>=J&&u(z[ie])&o;ie--)ae[ie]=oe.level;for(var ue=oe.level,ve=1/0,ke=0;ke<ae.length;ke++){var Ae=ae[ke];Ae>ue&&(ue=Ae),Ae<ve&&(ve=Ae|1)}for(var me=ue;me>=ve;me--)for(var ye=0;ye<ae.length;ye++)if(ae[ye]>=me){for(var fe=ye;ye+1<ae.length&&ae[ye+1]>=me;)ye++;ye>fe&&Q.push([fe+J,ye+J])}}}),Q}function re(z,te,$,O){var de=le(z,te,$,O),Q=[].concat(z);return de.forEach(function(oe,J){Q[J]=(te.levels[oe]&1?ge(z[oe]):null)||z[oe]}),Q.join("")}function le(z,te,$,O){for(var de=Z(z,te,$,O),Q=[],oe=0;oe<z.length;oe++)Q[oe]=oe;return de.forEach(function(J){for(var xe=J[0],ae=J[1],ie=Q.slice(xe,ae+1),ue=ie.length;ue--;)Q[ae-ue]=ie[ue]}),Q}return t.closingToOpeningBracket=k,t.getBidiCharType=u,t.getBidiCharTypeName=c,t.getCanonicalBracket=R,t.getEmbeddingLevels=K,t.getMirroredCharacter=ge,t.getMirroredCharactersMap=ce,t.getReorderSegments=Z,t.getReorderedIndices=le,t.getReorderedString=re,t.openingToClosingBracket=y,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return f}const Sn=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Ut(f){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function d(h,r){let e=zn[r];return e?Ut(e):h}return f.replace(t,d)}const Re=[];for(let f=0;f<256;f++)Re[f]=(f<16?"0":"")+f.toString(16);function ka(){const f=Math.random()*4294967295|0,t=Math.random()*4294967295|0,d=Math.random()*4294967295|0,h=Math.random()*4294967295|0;return(Re[f&255]+Re[f>>8&255]+Re[f>>16&255]+Re[f>>24&255]+"-"+Re[t&255]+Re[t>>8&255]+"-"+Re[t>>16&15|64]+Re[t>>24&255]+"-"+Re[d&63|128]+Re[d>>8&255]+"-"+Re[d>>16&255]+Re[d>>24&255]+Re[h&255]+Re[h>>8&255]+Re[h>>16&255]+Re[h>>24&255]).toUpperCase()}const tr=Object.assign||function(){let f=arguments[0];for(let t=1,d=arguments.length;t<d;t++){let h=arguments[t];if(h)for(let r in h)Object.prototype.hasOwnProperty.call(h,r)&&(f[r]=h[r])}return f},_a=Date.now(),nn=new WeakMap,an=new Map;let Ta=1e10;function kt(f,t){const d=Da(t);let h=nn.get(f);if(h||nn.set(f,h=Object.create(null)),h[d])return new h[d];const r=`_onBeforeCompile${d}`,e=function(o,s){f.onBeforeCompile.call(this,o,s);const l=this.customProgramCacheKey()+"|"+o.vertexShader+"|"+o.fragmentShader;let u=an[l];if(!u){const c=Fa(this,o,t,d);u=an[l]=c}o.vertexShader=u.vertexShader,o.fragmentShader=u.fragmentShader,tr(o.uniforms,this.uniforms),t.timeUniform&&(o.uniforms[t.timeUniform]={get value(){return Date.now()-_a}}),this[r]&&this[r](o)},a=function(){return i(t.chained?f:f.clone())},i=function(o){const s=Object.create(o,n);return Object.defineProperty(s,"baseMaterial",{value:f}),Object.defineProperty(s,"id",{value:Ta++}),s.uuid=ka(),s.uniforms=tr({},o.uniforms,t.uniforms),s.defines=tr({},o.defines,t.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${d}`]="",s.extensions=tr({},o.extensions,t.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>f.type,set:o=>{f.type=o}},isDerivedFrom:{writable:!0,configurable:!0,value:function(o){const s=this.baseMaterial;return o===s||s.isDerivedMaterial&&s.isDerivedFrom(o)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return f.customProgramCacheKey()+"|"+d}},onBeforeCompile:{get(){return e},set(o){this[r]=o}},copy:{writable:!0,configurable:!0,value:function(o){return f.copy.call(this,o),!f.isShaderMaterial&&!f.isDerivedMaterial&&(tr(this.extensions,o.extensions),tr(this.defines,o.defines),tr(this.uniforms,Wn.clone(o.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const o=new f.constructor;return i(o).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let o=this._depthMaterial;return o||(o=this._depthMaterial=kt(f.isDerivedMaterial?f.getDepthMaterial():new jn({depthPacking:Nn}),t),o.defines.IS_DEPTH_MATERIAL="",o.uniforms=this.uniforms),o}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let o=this._distanceMaterial;return o||(o=this._distanceMaterial=kt(f.isDerivedMaterial?f.getDistanceMaterial():new In,t),o.defines.IS_DISTANCE_MATERIAL="",o.uniforms=this.uniforms),o}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:o,_distanceMaterial:s}=this;o&&o.dispose(),s&&s.dispose(),f.dispose.call(this)}}};return h[d]=a,new a}function Fa(f,{vertexShader:t,fragmentShader:d},h,r){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:i,vertexTransform:n,fragmentDefs:o,fragmentMainIntro:s,fragmentMainOutro:l,fragmentColorTransform:u,customRewriter:c,timeUniform:g}=h;if(e=e||"",a=a||"",i=i||"",o=o||"",s=s||"",l=l||"",(n||c)&&(t=Ut(t)),(u||c)&&(d=d.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),d=Ut(d)),c){let p=c({vertexShader:t,fragmentShader:d});t=p.vertexShader,d=p.fragmentShader}if(u){let p=[];d=d.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(p.push(m),"")),l=`${u}
${p.join(`
`)}
${l}`}if(g){const p=`
uniform float ${g};
`;e=p+e,o=p+o}return n&&(t=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${t}
`,e=`${e}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${a}
`,t=t.replace(/\b(position|normal|uv)\b/g,(p,m,G,S)=>/\battribute\s+vec[23]\s+$/.test(S.substr(0,G))?m:`troika_${m}_${r}`),f.map&&f.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),t=on(t,r,e,a,i),d=on(d,r,o,s,l),{vertexShader:t,fragmentShader:d}}function on(f,t,d,h,r){return(h||r||d)&&(f=f.replace(Sn,`
${d}
void troikaOrigMain${t}() {`),f+=`
void main() {
  ${h}
  troikaOrigMain${t}();
  ${r}
}`),f}function Ca(f,t){return f==="uniforms"?void 0:typeof t=="function"?t.toString():t}let Aa=0;const sn=new Map;function Da(f){const t=JSON.stringify(f,Ca);let d=sn.get(t);return d==null&&sn.set(t,d=++Aa),d}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Ea(){return typeof window>"u"&&(self.window=self),function(f){var t={parse:function(r){var e=t._bin,a=new Uint8Array(r);if(e.readASCII(a,0,4)=="ttcf"){var i=4;e.readUshort(a,i),i+=2,e.readUshort(a,i),i+=2;var n=e.readUint(a,i);i+=4;for(var o=[],s=0;s<n;s++){var l=e.readUint(a,i);i+=4,o.push(t._readFont(a,l))}return o}return[t._readFont(a,0)]},_readFont:function(r,e){var a=t._bin,i=e;a.readFixed(r,e),e+=4;var n=a.readUshort(r,e);e+=2,a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:r,_offset:i},l={},u=0;u<n;u++){var c=a.readASCII(r,e,4);e+=4,a.readUint(r,e),e+=4;var g=a.readUint(r,e);e+=4;var p=a.readUint(r,e);e+=4,l[c]={offset:g,length:p}}for(u=0;u<o.length;u++){var m=o[u];l[m]&&(s[m.trim()]=t[m.trim()].parse(r,l[m].offset,l[m].length,s))}return s},_tabOffset:function(r,e,a){for(var i=t._bin,n=i.readUshort(r,a+4),o=a+12,s=0;s<n;s++){var l=i.readASCII(r,o,4);o+=4,i.readUint(r,o),o+=4;var u=i.readUint(r,o);if(o+=4,i.readUint(r,o),o+=4,l==e)return u}return 0}};t._bin={readFixed:function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<8|r[e+3])/65540},readF2dot14:function(r,e){return t._bin.readShort(r,e)/16384},readInt:function(r,e){return t._bin._view(r).getInt32(e)},readInt8:function(r,e){return t._bin._view(r).getInt8(e)},readShort:function(r,e){return t._bin._view(r).getInt16(e)},readUshort:function(r,e){return t._bin._view(r).getUint16(e)},readUshorts:function(r,e,a){for(var i=[],n=0;n<a;n++)i.push(t._bin.readUshort(r,e+2*n));return i},readUint:function(r,e){return t._bin._view(r).getUint32(e)},readUint64:function(r,e){return 4294967296*t._bin.readUint(r,e)+t._bin.readUint(r,e+4)},readASCII:function(r,e,a){for(var i="",n=0;n<a;n++)i+=String.fromCharCode(r[e+n]);return i},readUnicode:function(r,e,a){for(var i="",n=0;n<a;n++){var o=r[e++]<<8|r[e++];i+=String.fromCharCode(o)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,e,a){var i=t._bin._tdec;return i&&e==0&&a==r.length?i.decode(r):t._bin.readASCII(r,e,a)},readBytes:function(r,e,a){for(var i=[],n=0;n<a;n++)i.push(r[e+n]);return i},readASCIIArray:function(r,e,a){for(var i=[],n=0;n<a;n++)i.push(String.fromCharCode(r[e+n]));return i},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},t._lctf={},t._lctf.parse=function(r,e,a,i,n){var o=t._bin,s={},l=e;o.readFixed(r,e),e+=4;var u=o.readUshort(r,e);e+=2;var c=o.readUshort(r,e);e+=2;var g=o.readUshort(r,e);return e+=2,s.scriptList=t._lctf.readScriptList(r,l+u),s.featureList=t._lctf.readFeatureList(r,l+c),s.lookupList=t._lctf.readLookupList(r,l+g,n),s},t._lctf.readLookupList=function(r,e,a){var i=t._bin,n=e,o=[],s=i.readUshort(r,e);e+=2;for(var l=0;l<s;l++){var u=i.readUshort(r,e);e+=2;var c=t._lctf.readLookupTable(r,n+u,a);o.push(c)}return o},t._lctf.readLookupTable=function(r,e,a){var i=t._bin,n=e,o={tabs:[]};o.ltype=i.readUshort(r,e),e+=2,o.flag=i.readUshort(r,e),e+=2;var s=i.readUshort(r,e);e+=2;for(var l=o.ltype,u=0;u<s;u++){var c=i.readUshort(r,e);e+=2;var g=a(r,l,n+c,o);o.tabs.push(g)}return o},t._lctf.numOfOnes=function(r){for(var e=0,a=0;a<32;a++)(r>>>a&1)!=0&&e++;return e},t._lctf.readClassDef=function(r,e){var a=t._bin,i=[],n=a.readUshort(r,e);if(e+=2,n==1){var o=a.readUshort(r,e);e+=2;var s=a.readUshort(r,e);e+=2;for(var l=0;l<s;l++)i.push(o+l),i.push(o+l),i.push(a.readUshort(r,e)),e+=2}if(n==2){var u=a.readUshort(r,e);for(e+=2,l=0;l<u;l++)i.push(a.readUshort(r,e)),e+=2,i.push(a.readUshort(r,e)),e+=2,i.push(a.readUshort(r,e)),e+=2}return i},t._lctf.getInterval=function(r,e){for(var a=0;a<r.length;a+=3){var i=r[a],n=r[a+1];if(r[a+2],i<=e&&e<=n)return a}return-1},t._lctf.readCoverage=function(r,e){var a=t._bin,i={};i.fmt=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);return e+=2,i.fmt==1&&(i.tab=a.readUshorts(r,e,n)),i.fmt==2&&(i.tab=a.readUshorts(r,e,3*n)),i},t._lctf.coverageIndex=function(r,e){var a=r.tab;if(r.fmt==1)return a.indexOf(e);if(r.fmt==2){var i=t._lctf.getInterval(a,e);if(i!=-1)return a[i+2]+(e-a[i])}return-1},t._lctf.readFeatureList=function(r,e){var a=t._bin,i=e,n=[],o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var l=a.readASCII(r,e,4);e+=4;var u=a.readUshort(r,e);e+=2;var c=t._lctf.readFeatureTable(r,i+u);c.tag=l.trim(),n.push(c)}return n},t._lctf.readFeatureTable=function(r,e){var a=t._bin,i=e,n={},o=a.readUshort(r,e);e+=2,o>0&&(n.featureParams=i+o);var s=a.readUshort(r,e);e+=2,n.tab=[];for(var l=0;l<s;l++)n.tab.push(a.readUshort(r,e+2*l));return n},t._lctf.readScriptList=function(r,e){var a=t._bin,i=e,n={},o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var l=a.readASCII(r,e,4);e+=4;var u=a.readUshort(r,e);e+=2,n[l.trim()]=t._lctf.readScriptTable(r,i+u)}return n},t._lctf.readScriptTable=function(r,e){var a=t._bin,i=e,n={},o=a.readUshort(r,e);e+=2,o>0&&(n.default=t._lctf.readLangSysTable(r,i+o));var s=a.readUshort(r,e);e+=2;for(var l=0;l<s;l++){var u=a.readASCII(r,e,4);e+=4;var c=a.readUshort(r,e);e+=2,n[u.trim()]=t._lctf.readLangSysTable(r,i+c)}return n},t._lctf.readLangSysTable=function(r,e){var a=t._bin,i={};a.readUshort(r,e),e+=2,i.reqFeature=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);return e+=2,i.features=a.readUshorts(r,e,n),i},t.CFF={},t.CFF.parse=function(r,e,a){var i=t._bin;(r=new Uint8Array(r.buffer,e,a))[e=0],r[++e],r[++e],r[++e],e++;var n=[];e=t.CFF.readIndex(r,e,n);for(var o=[],s=0;s<n.length-1;s++)o.push(i.readASCII(r,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var l=[];e=t.CFF.readIndex(r,e,l);var u=[];for(s=0;s<l.length-1;s++)u.push(t.CFF.readDict(r,e+l[s],e+l[s+1]));e+=l[l.length-1];var c=u[0],g=[];e=t.CFF.readIndex(r,e,g);var p=[];for(s=0;s<g.length-1;s++)p.push(i.readASCII(r,e+g[s],g[s+1]-g[s]));if(e+=g[g.length-1],t.CFF.readSubrs(r,e,c),c.CharStrings){e=c.CharStrings,g=[],e=t.CFF.readIndex(r,e,g);var m=[];for(s=0;s<g.length-1;s++)m.push(i.readBytes(r,e+g[s],g[s+1]-g[s]));c.CharStrings=m}if(c.ROS){e=c.FDArray;var G=[];for(e=t.CFF.readIndex(r,e,G),c.FDArray=[],s=0;s<G.length-1;s++){var S=t.CFF.readDict(r,e+G[s],e+G[s+1]);t.CFF._readFDict(r,S,p),c.FDArray.push(S)}e+=G[G.length-1],e=c.FDSelect,c.FDSelect=[];var T=r[e];if(e++,T!=3)throw T;var y=i.readUshort(r,e);for(e+=2,s=0;s<y+1;s++)c.FDSelect.push(i.readUshort(r,e),r[e+2]),e+=3}return c.Encoding&&(c.Encoding=t.CFF.readEncoding(r,c.Encoding,c.CharStrings.length)),c.charset&&(c.charset=t.CFF.readCharset(r,c.charset,c.CharStrings.length)),t.CFF._readFDict(r,c,p),c},t.CFF._readFDict=function(r,e,a){var i;for(var n in e.Private&&(i=e.Private[1],e.Private=t.CFF.readDict(r,i,i+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(r,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},t.CFF.readSubrs=function(r,e,a){var i=t._bin,n=[];e=t.CFF.readIndex(r,e,n);var o,s=n.length;o=s<1240?107:s<33900?1131:32768,a.Bias=o,a.Subrs=[];for(var l=0;l<n.length-1;l++)a.Subrs.push(i.readBytes(r,e+n[l],n[l+1]-n[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(r,e){for(var a=0;a<r.charset.length;a++)if(r.charset[a]==e)return a;return-1},t.CFF.glyphBySE=function(r,e){return e<0||e>255?-1:t.CFF.glyphByUnicode(r,t.CFF.tableSE[e])},t.CFF.readEncoding=function(r,e,a){t._bin;var i=[".notdef"],n=r[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var o=r[e];e++;for(var s=0;s<o;s++)i.push(r[e+s]);return i},t.CFF.readCharset=function(r,e,a){var i=t._bin,n=[".notdef"],o=r[e];if(e++,o==0)for(var s=0;s<a;s++){var l=i.readUshort(r,e);e+=2,n.push(l)}else{if(o!=1&&o!=2)throw"error: format: "+o;for(;n.length<a;){l=i.readUshort(r,e),e+=2;var u=0;for(o==1?(u=r[e],e++):(u=i.readUshort(r,e),e+=2),s=0;s<=u;s++)n.push(l),l++}}return n},t.CFF.readIndex=function(r,e,a){var i=t._bin,n=i.readUshort(r,e)+1,o=r[e+=2];if(e++,o==1)for(var s=0;s<n;s++)a.push(r[e+s]);else if(o==2)for(s=0;s<n;s++)a.push(i.readUshort(r,e+2*s));else if(o==3)for(s=0;s<n;s++)a.push(16777215&i.readUint(r,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+o+", count: "+n;return(e+=n*o)-1},t.CFF.getCharString=function(r,e,a){var i=t._bin,n=r[e],o=r[e+1];r[e+2],r[e+3],r[e+4];var s=1,l=null,u=null;n<=20&&(l=n,s=1),n==12&&(l=100*n+o,s=2),21<=n&&n<=27&&(l=n,s=1),n==28&&(u=i.readShort(r,e+1),s=3),29<=n&&n<=31&&(l=n,s=1),32<=n&&n<=246&&(u=n-139,s=1),247<=n&&n<=250&&(u=256*(n-247)+o+108,s=2),251<=n&&n<=254&&(u=256*-(n-251)-o-108,s=2),n==255&&(u=i.readInt(r,e+1)/65535,s=5),a.val=u??"o"+l,a.size=s},t.CFF.readCharString=function(r,e,a){for(var i=e+a,n=t._bin,o=[];e<i;){var s=r[e],l=r[e+1];r[e+2],r[e+3],r[e+4];var u=1,c=null,g=null;s<=20&&(c=s,u=1),s==12&&(c=100*s+l,u=2),s!=19&&s!=20||(c=s,u=2),21<=s&&s<=27&&(c=s,u=1),s==28&&(g=n.readShort(r,e+1),u=3),29<=s&&s<=31&&(c=s,u=1),32<=s&&s<=246&&(g=s-139,u=1),247<=s&&s<=250&&(g=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(g=256*-(s-251)-l-108,u=2),s==255&&(g=n.readInt(r,e+1)/65535,u=5),o.push(g??"o"+c),e+=u}return o},t.CFF.readDict=function(r,e,a){for(var i=t._bin,n={},o=[];e<a;){var s=r[e],l=r[e+1];r[e+2],r[e+3],r[e+4];var u=1,c=null,g=null;if(s==28&&(g=i.readShort(r,e+1),u=3),s==29&&(g=i.readInt(r,e+1),u=5),32<=s&&s<=246&&(g=s-139,u=1),247<=s&&s<=250&&(g=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(g=256*-(s-251)-l-108,u=2),s==255)throw g=i.readInt(r,e+1)/65535,u=5,"unknown number";if(s==30){var p=[];for(u=1;;){var m=r[e+u];u++;var G=m>>4,S=15&m;if(G!=15&&p.push(G),S!=15&&p.push(S),S==15)break}for(var T="",y=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],k=0;k<p.length;k++)T+=y[p[k]];g=parseFloat(T)}s<=21&&(c=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,s==12&&(c=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],u=2)),c!=null?(n[c]=o.length==1?o[0]:o,o=[]):o.push(g),e+=u}return n},t.cmap={},t.cmap.parse=function(r,e,a){r=new Uint8Array(r.buffer,e,a),e=0;var i=t._bin,n={};i.readUshort(r,e),e+=2;var o=i.readUshort(r,e);e+=2;var s=[];n.tables=[];for(var l=0;l<o;l++){var u=i.readUshort(r,e);e+=2;var c=i.readUshort(r,e);e+=2;var g=i.readUint(r,e);e+=4;var p="p"+u+"e"+c,m=s.indexOf(g);if(m==-1){var G;m=n.tables.length,s.push(g);var S=i.readUshort(r,g);S==0?G=t.cmap.parse0(r,g):S==4?G=t.cmap.parse4(r,g):S==6?G=t.cmap.parse6(r,g):S==12?G=t.cmap.parse12(r,g):console.debug("unknown format: "+S,u,c,g),n.tables.push(G)}if(n[p]!=null)throw"multiple tables for one platform+encoding";n[p]=m}return n},t.cmap.parse0=function(r,e){var a=t._bin,i={};i.format=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);e+=2,a.readUshort(r,e),e+=2,i.map=[];for(var o=0;o<n-6;o++)i.map.push(r[e+o]);return i},t.cmap.parse4=function(r,e){var a=t._bin,i=e,n={};n.format=a.readUshort(r,e),e+=2;var o=a.readUshort(r,e);e+=2,a.readUshort(r,e),e+=2;var s=a.readUshort(r,e);e+=2;var l=s/2;n.searchRange=a.readUshort(r,e),e+=2,n.entrySelector=a.readUshort(r,e),e+=2,n.rangeShift=a.readUshort(r,e),e+=2,n.endCount=a.readUshorts(r,e,l),e+=2*l,e+=2,n.startCount=a.readUshorts(r,e,l),e+=2*l,n.idDelta=[];for(var u=0;u<l;u++)n.idDelta.push(a.readShort(r,e)),e+=2;for(n.idRangeOffset=a.readUshorts(r,e,l),e+=2*l,n.glyphIdArray=[];e<i+o;)n.glyphIdArray.push(a.readUshort(r,e)),e+=2;return n},t.cmap.parse6=function(r,e){var a=t._bin,i={};i.format=a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2,i.firstCode=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);e+=2,i.glyphIdArray=[];for(var o=0;o<n;o++)i.glyphIdArray.push(a.readUshort(r,e)),e+=2;return i},t.cmap.parse12=function(r,e){var a=t._bin,i={};i.format=a.readUshort(r,e),e+=2,e+=2,a.readUint(r,e),e+=4,a.readUint(r,e),e+=4;var n=a.readUint(r,e);e+=4,i.groups=[];for(var o=0;o<n;o++){var s=e+12*o,l=a.readUint(r,s+0),u=a.readUint(r,s+4),c=a.readUint(r,s+8);i.groups.push([l,u,c])}return i},t.glyf={},t.glyf.parse=function(r,e,a,i){for(var n=[],o=0;o<i.maxp.numGlyphs;o++)n.push(null);return n},t.glyf._parseGlyf=function(r,e){var a=t._bin,i=r._data,n=t._tabOffset(i,"glyf",r._offset)+r.loca[e];if(r.loca[e]==r.loca[e+1])return null;var o={};if(o.noc=a.readShort(i,n),n+=2,o.xMin=a.readShort(i,n),n+=2,o.yMin=a.readShort(i,n),n+=2,o.xMax=a.readShort(i,n),n+=2,o.yMax=a.readShort(i,n),n+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(a.readUshort(i,n)),n+=2;var l=a.readUshort(i,n);if(n+=2,i.length-n<l)return null;o.instructions=a.readBytes(i,n,l),n+=l;var u=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<u;s++){var c=i[n];if(n++,o.flags.push(c),(8&c)!=0){var g=i[n];n++;for(var p=0;p<g;p++)o.flags.push(c),s++}}for(o.xs=[],s=0;s<u;s++){var m=(2&o.flags[s])!=0,G=(16&o.flags[s])!=0;m?(o.xs.push(G?i[n]:-i[n]),n++):G?o.xs.push(0):(o.xs.push(a.readShort(i,n)),n+=2)}for(o.ys=[],s=0;s<u;s++)m=(4&o.flags[s])!=0,G=(32&o.flags[s])!=0,m?(o.ys.push(G?i[n]:-i[n]),n++):G?o.ys.push(0):(o.ys.push(a.readShort(i,n)),n+=2);var S=0,T=0;for(s=0;s<u;s++)S+=o.xs[s],T+=o.ys[s],o.xs[s]=S,o.ys[s]=T}else{var y;o.parts=[];do{y=a.readUshort(i,n),n+=2;var k={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(k),k.glyphIndex=a.readUshort(i,n),n+=2,1&y){var R=a.readShort(i,n);n+=2;var w=a.readShort(i,n);n+=2}else R=a.readInt8(i,n),n++,w=a.readInt8(i,n),n++;2&y?(k.m.tx=R,k.m.ty=w):(k.p1=R,k.p2=w),8&y?(k.m.a=k.m.d=a.readF2dot14(i,n),n+=2):64&y?(k.m.a=a.readF2dot14(i,n),n+=2,k.m.d=a.readF2dot14(i,n),n+=2):128&y&&(k.m.a=a.readF2dot14(i,n),n+=2,k.m.b=a.readF2dot14(i,n),n+=2,k.m.c=a.readF2dot14(i,n),n+=2,k.m.d=a.readF2dot14(i,n),n+=2)}while(32&y);if(256&y){var _=a.readUshort(i,n);for(n+=2,o.instr=[],s=0;s<_;s++)o.instr.push(i[n]),n++}}return o},t.GDEF={},t.GDEF.parse=function(r,e,a,i){var n=e;e+=4;var o=t._bin.readUshort(r,e);return{glyphClassDef:o===0?null:t._lctf.readClassDef(r,n+o)}},t.GPOS={},t.GPOS.parse=function(r,e,a,i){return t._lctf.parse(r,e,a,i,t.GPOS.subt)},t.GPOS.subt=function(r,e,a,i){var n=t._bin,o=a,s={};if(s.fmt=n.readUshort(r,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var l=n.readUshort(r,a);a+=2,s.coverage=t._lctf.readCoverage(r,l+o)}if(e==1&&s.fmt==1){var u=n.readUshort(r,a);a+=2,u!=0&&(s.pos=t.GPOS.readValueRecord(r,a,u))}else if(e==2&&s.fmt>=1&&s.fmt<=2){u=n.readUshort(r,a),a+=2;var c=n.readUshort(r,a);a+=2;var g=t._lctf.numOfOnes(u),p=t._lctf.numOfOnes(c);if(s.fmt==1){s.pairsets=[];var m=n.readUshort(r,a);a+=2;for(var G=0;G<m;G++){var S=o+n.readUshort(r,a);a+=2;var T=n.readUshort(r,S);S+=2;for(var y=[],k=0;k<T;k++){var R=n.readUshort(r,S);S+=2,u!=0&&(b=t.GPOS.readValueRecord(r,S,u),S+=2*g),c!=0&&(E=t.GPOS.readValueRecord(r,S,c),S+=2*p),y.push({gid2:R,val1:b,val2:E})}s.pairsets.push(y)}}if(s.fmt==2){var w=n.readUshort(r,a);a+=2;var _=n.readUshort(r,a);a+=2;var B=n.readUshort(r,a);a+=2;var D=n.readUshort(r,a);for(a+=2,s.classDef1=t._lctf.readClassDef(r,o+w),s.classDef2=t._lctf.readClassDef(r,o+_),s.matrix=[],G=0;G<B;G++){var Y=[];for(k=0;k<D;k++){var b=null,E=null;u!=0&&(b=t.GPOS.readValueRecord(r,a,u),a+=2*g),c!=0&&(E=t.GPOS.readValueRecord(r,a,c),a+=2*p),Y.push({val1:b,val2:E})}s.matrix.push(Y)}}}else if(e==4&&s.fmt==1)s.markCoverage=t._lctf.readCoverage(r,n.readUshort(r,a)+o),s.baseCoverage=t._lctf.readCoverage(r,n.readUshort(r,a+2)+o),s.markClassCount=n.readUshort(r,a+4),s.markArray=t.GPOS.readMarkArray(r,n.readUshort(r,a+6)+o),s.baseArray=t.GPOS.readBaseArray(r,n.readUshort(r,a+8)+o,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=t._lctf.readCoverage(r,n.readUshort(r,a)+o),s.mark2Coverage=t._lctf.readCoverage(r,n.readUshort(r,a+2)+o),s.markClassCount=n.readUshort(r,a+4),s.mark1Array=t.GPOS.readMarkArray(r,n.readUshort(r,a+6)+o),s.mark2Array=t.GPOS.readBaseArray(r,n.readUshort(r,a+8)+o,s.markClassCount);else{if(e==9&&s.fmt==1){var C=n.readUshort(r,a);a+=2;var H=n.readUint(r,a);if(a+=4,i.ltype==9)i.ltype=C;else if(i.ltype!=C)throw"invalid extension substitution";return t.GPOS.subt(r,i.ltype,o+H)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},t.GPOS.readValueRecord=function(r,e,a){var i=t._bin,n=[];return n.push(1&a?i.readShort(r,e):0),e+=1&a?2:0,n.push(2&a?i.readShort(r,e):0),e+=2&a?2:0,n.push(4&a?i.readShort(r,e):0),e+=4&a?2:0,n.push(8&a?i.readShort(r,e):0),e+=8&a?2:0,n},t.GPOS.readBaseArray=function(r,e,a){var i=t._bin,n=[],o=e,s=i.readUshort(r,e);e+=2;for(var l=0;l<s;l++){for(var u=[],c=0;c<a;c++)u.push(t.GPOS.readAnchorRecord(r,o+i.readUshort(r,e))),e+=2;n.push(u)}return n},t.GPOS.readMarkArray=function(r,e){var a=t._bin,i=[],n=e,o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var l=t.GPOS.readAnchorRecord(r,a.readUshort(r,e+2)+n);l.markClass=a.readUshort(r,e),i.push(l),e+=4}return i},t.GPOS.readAnchorRecord=function(r,e){var a=t._bin,i={};return i.fmt=a.readUshort(r,e),i.x=a.readShort(r,e+2),i.y=a.readShort(r,e+4),i},t.GSUB={},t.GSUB.parse=function(r,e,a,i){return t._lctf.parse(r,e,a,i,t.GSUB.subt)},t.GSUB.subt=function(r,e,a,i){var n=t._bin,o=a,s={};if(s.fmt=n.readUshort(r,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var l=n.readUshort(r,a);a+=2,s.coverage=t._lctf.readCoverage(r,o+l)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(r,a),a+=2;else if(s.fmt==2){var u=n.readUshort(r,a);a+=2,s.newg=n.readUshorts(r,a,u),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){u=n.readUshort(r,a),a+=2,s.seqs=[];for(var c=0;c<u;c++){var g=n.readUshort(r,a)+o;a+=2;var p=n.readUshort(r,g);s.seqs.push(n.readUshorts(r,g+2,p))}}else if(e==4)for(s.vals=[],u=n.readUshort(r,a),a+=2,c=0;c<u;c++){var m=n.readUshort(r,a);a+=2,s.vals.push(t.GSUB.readLigatureSet(r,o+m))}else if(e==5&&s.fmt==2){if(s.fmt==2){var G=n.readUshort(r,a);a+=2,s.cDef=t._lctf.readClassDef(r,o+G),s.scset=[];var S=n.readUshort(r,a);for(a+=2,c=0;c<S;c++){var T=n.readUshort(r,a);a+=2,s.scset.push(T==0?null:t.GSUB.readSubClassSet(r,o+T))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(c=0;c<3;c++){u=n.readUshort(r,a),a+=2;for(var y=[],k=0;k<u;k++)y.push(t._lctf.readCoverage(r,o+n.readUshort(r,a+2*k)));a+=2*u,c==0&&(s.backCvg=y),c==1&&(s.inptCvg=y),c==2&&(s.ahedCvg=y)}u=n.readUshort(r,a),a+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(r,a,u)}}else{if(e==7&&s.fmt==1){var R=n.readUshort(r,a);a+=2;var w=n.readUint(r,a);if(a+=4,i.ltype==9)i.ltype=R;else if(i.ltype!=R)throw"invalid extension substitution";return t.GSUB.subt(r,i.ltype,o+w)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},t.GSUB.readSubClassSet=function(r,e){var a=t._bin.readUshort,i=e,n=[],o=a(r,e);e+=2;for(var s=0;s<o;s++){var l=a(r,e);e+=2,n.push(t.GSUB.readSubClassRule(r,i+l))}return n},t.GSUB.readSubClassRule=function(r,e){var a=t._bin.readUshort,i={},n=a(r,e),o=a(r,e+=2);e+=2,i.input=[];for(var s=0;s<n-1;s++)i.input.push(a(r,e)),e+=2;return i.substLookupRecords=t.GSUB.readSubstLookupRecords(r,e,o),i},t.GSUB.readSubstLookupRecords=function(r,e,a){for(var i=t._bin.readUshort,n=[],o=0;o<a;o++)n.push(i(r,e),i(r,e+2)),e+=4;return n},t.GSUB.readChainSubClassSet=function(r,e){var a=t._bin,i=e,n=[],o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var l=a.readUshort(r,e);e+=2,n.push(t.GSUB.readChainSubClassRule(r,i+l))}return n},t.GSUB.readChainSubClassRule=function(r,e){for(var a=t._bin,i={},n=["backtrack","input","lookahead"],o=0;o<n.length;o++){var s=a.readUshort(r,e);e+=2,o==1&&s--,i[n[o]]=a.readUshorts(r,e,s),e+=2*i[n[o]].length}return s=a.readUshort(r,e),e+=2,i.subst=a.readUshorts(r,e,2*s),e+=2*i.subst.length,i},t.GSUB.readLigatureSet=function(r,e){var a=t._bin,i=e,n=[],o=a.readUshort(r,e);e+=2;for(var s=0;s<o;s++){var l=a.readUshort(r,e);e+=2,n.push(t.GSUB.readLigature(r,i+l))}return n},t.GSUB.readLigature=function(r,e){var a=t._bin,i={chain:[]};i.nglyph=a.readUshort(r,e),e+=2;var n=a.readUshort(r,e);e+=2;for(var o=0;o<n-1;o++)i.chain.push(a.readUshort(r,e)),e+=2;return i},t.head={},t.head.parse=function(r,e,a){var i=t._bin,n={};return i.readFixed(r,e),e+=4,n.fontRevision=i.readFixed(r,e),e+=4,i.readUint(r,e),e+=4,i.readUint(r,e),e+=4,n.flags=i.readUshort(r,e),e+=2,n.unitsPerEm=i.readUshort(r,e),e+=2,n.created=i.readUint64(r,e),e+=8,n.modified=i.readUint64(r,e),e+=8,n.xMin=i.readShort(r,e),e+=2,n.yMin=i.readShort(r,e),e+=2,n.xMax=i.readShort(r,e),e+=2,n.yMax=i.readShort(r,e),e+=2,n.macStyle=i.readUshort(r,e),e+=2,n.lowestRecPPEM=i.readUshort(r,e),e+=2,n.fontDirectionHint=i.readShort(r,e),e+=2,n.indexToLocFormat=i.readShort(r,e),e+=2,n.glyphDataFormat=i.readShort(r,e),e+=2,n},t.hhea={},t.hhea.parse=function(r,e,a){var i=t._bin,n={};return i.readFixed(r,e),e+=4,n.ascender=i.readShort(r,e),e+=2,n.descender=i.readShort(r,e),e+=2,n.lineGap=i.readShort(r,e),e+=2,n.advanceWidthMax=i.readUshort(r,e),e+=2,n.minLeftSideBearing=i.readShort(r,e),e+=2,n.minRightSideBearing=i.readShort(r,e),e+=2,n.xMaxExtent=i.readShort(r,e),e+=2,n.caretSlopeRise=i.readShort(r,e),e+=2,n.caretSlopeRun=i.readShort(r,e),e+=2,n.caretOffset=i.readShort(r,e),e+=2,e+=8,n.metricDataFormat=i.readShort(r,e),e+=2,n.numberOfHMetrics=i.readUshort(r,e),e+=2,n},t.hmtx={},t.hmtx.parse=function(r,e,a,i){for(var n=t._bin,o={aWidth:[],lsBearing:[]},s=0,l=0,u=0;u<i.maxp.numGlyphs;u++)u<i.hhea.numberOfHMetrics&&(s=n.readUshort(r,e),e+=2,l=n.readShort(r,e),e+=2),o.aWidth.push(s),o.lsBearing.push(l);return o},t.kern={},t.kern.parse=function(r,e,a,i){var n=t._bin,o=n.readUshort(r,e);if(e+=2,o==1)return t.kern.parseV1(r,e-2,a,i);var s=n.readUshort(r,e);e+=2;for(var l={glyph1:[],rval:[]},u=0;u<s;u++){e+=2,a=n.readUshort(r,e),e+=2;var c=n.readUshort(r,e);e+=2;var g=c>>>8;if((g&=15)!=0)throw"unknown kern table format: "+g;e=t.kern.readFormat0(r,e,l)}return l},t.kern.parseV1=function(r,e,a,i){var n=t._bin;n.readFixed(r,e),e+=4;var o=n.readUint(r,e);e+=4;for(var s={glyph1:[],rval:[]},l=0;l<o;l++){n.readUint(r,e),e+=4;var u=n.readUshort(r,e);e+=2,n.readUshort(r,e),e+=2;var c=u>>>8;if((c&=15)!=0)throw"unknown kern table format: "+c;e=t.kern.readFormat0(r,e,s)}return s},t.kern.readFormat0=function(r,e,a){var i=t._bin,n=-1,o=i.readUshort(r,e);e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2;for(var s=0;s<o;s++){var l=i.readUshort(r,e);e+=2;var u=i.readUshort(r,e);e+=2;var c=i.readShort(r,e);e+=2,l!=n&&(a.glyph1.push(l),a.rval.push({glyph2:[],vals:[]}));var g=a.rval[a.rval.length-1];g.glyph2.push(u),g.vals.push(c),n=l}return e},t.loca={},t.loca.parse=function(r,e,a,i){var n=t._bin,o=[],s=i.head.indexToLocFormat,l=i.maxp.numGlyphs+1;if(s==0)for(var u=0;u<l;u++)o.push(n.readUshort(r,e+(u<<1))<<1);if(s==1)for(u=0;u<l;u++)o.push(n.readUint(r,e+(u<<2)));return o},t.maxp={},t.maxp.parse=function(r,e,a){var i=t._bin,n={},o=i.readUint(r,e);return e+=4,n.numGlyphs=i.readUshort(r,e),e+=2,o==65536&&(n.maxPoints=i.readUshort(r,e),e+=2,n.maxContours=i.readUshort(r,e),e+=2,n.maxCompositePoints=i.readUshort(r,e),e+=2,n.maxCompositeContours=i.readUshort(r,e),e+=2,n.maxZones=i.readUshort(r,e),e+=2,n.maxTwilightPoints=i.readUshort(r,e),e+=2,n.maxStorage=i.readUshort(r,e),e+=2,n.maxFunctionDefs=i.readUshort(r,e),e+=2,n.maxInstructionDefs=i.readUshort(r,e),e+=2,n.maxStackElements=i.readUshort(r,e),e+=2,n.maxSizeOfInstructions=i.readUshort(r,e),e+=2,n.maxComponentElements=i.readUshort(r,e),e+=2,n.maxComponentDepth=i.readUshort(r,e),e+=2),n},t.name={},t.name.parse=function(r,e,a){var i=t._bin,n={};i.readUshort(r,e),e+=2;var o=i.readUshort(r,e);e+=2,i.readUshort(r,e);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=e+=2,c=0;c<o;c++){var g=i.readUshort(r,e);e+=2;var p=i.readUshort(r,e);e+=2;var m=i.readUshort(r,e);e+=2;var G=i.readUshort(r,e);e+=2;var S=i.readUshort(r,e);e+=2;var T=i.readUshort(r,e);e+=2;var y,k=l[G],R=u+12*o+T;if(g==0)y=i.readUnicode(r,R,S/2);else if(g==3&&p==0)y=i.readUnicode(r,R,S/2);else if(p==0)y=i.readASCII(r,R,S);else if(p==1)y=i.readUnicode(r,R,S/2);else if(p==3)y=i.readUnicode(r,R,S/2);else{if(g!=1)throw"unknown encoding "+p+", platformID: "+g;y=i.readASCII(r,R,S),console.debug("reading unknown MAC encoding "+p+" as ASCII")}var w="p"+g+","+m.toString(16);n[w]==null&&(n[w]={}),n[w][k!==void 0?k:G]=y,n[w]._lang=m}for(var _ in n)if(n[_].postScriptName!=null&&n[_]._lang==1033)return n[_];for(var _ in n)if(n[_].postScriptName!=null&&n[_]._lang==0)return n[_];for(var _ in n)if(n[_].postScriptName!=null&&n[_]._lang==3084)return n[_];for(var _ in n)if(n[_].postScriptName!=null)return n[_];for(var _ in n){s=_;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},t["OS/2"]={},t["OS/2"].parse=function(r,e,a){var i=t._bin.readUshort(r,e);e+=2;var n={};if(i==0)t["OS/2"].version0(r,e,n);else if(i==1)t["OS/2"].version1(r,e,n);else if(i==2||i==3||i==4)t["OS/2"].version2(r,e,n);else{if(i!=5)throw"unknown OS/2 table version: "+i;t["OS/2"].version5(r,e,n)}return n},t["OS/2"].version0=function(r,e,a){var i=t._bin;return a.xAvgCharWidth=i.readShort(r,e),e+=2,a.usWeightClass=i.readUshort(r,e),e+=2,a.usWidthClass=i.readUshort(r,e),e+=2,a.fsType=i.readUshort(r,e),e+=2,a.ySubscriptXSize=i.readShort(r,e),e+=2,a.ySubscriptYSize=i.readShort(r,e),e+=2,a.ySubscriptXOffset=i.readShort(r,e),e+=2,a.ySubscriptYOffset=i.readShort(r,e),e+=2,a.ySuperscriptXSize=i.readShort(r,e),e+=2,a.ySuperscriptYSize=i.readShort(r,e),e+=2,a.ySuperscriptXOffset=i.readShort(r,e),e+=2,a.ySuperscriptYOffset=i.readShort(r,e),e+=2,a.yStrikeoutSize=i.readShort(r,e),e+=2,a.yStrikeoutPosition=i.readShort(r,e),e+=2,a.sFamilyClass=i.readShort(r,e),e+=2,a.panose=i.readBytes(r,e,10),e+=10,a.ulUnicodeRange1=i.readUint(r,e),e+=4,a.ulUnicodeRange2=i.readUint(r,e),e+=4,a.ulUnicodeRange3=i.readUint(r,e),e+=4,a.ulUnicodeRange4=i.readUint(r,e),e+=4,a.achVendID=[i.readInt8(r,e),i.readInt8(r,e+1),i.readInt8(r,e+2),i.readInt8(r,e+3)],e+=4,a.fsSelection=i.readUshort(r,e),e+=2,a.usFirstCharIndex=i.readUshort(r,e),e+=2,a.usLastCharIndex=i.readUshort(r,e),e+=2,a.sTypoAscender=i.readShort(r,e),e+=2,a.sTypoDescender=i.readShort(r,e),e+=2,a.sTypoLineGap=i.readShort(r,e),e+=2,a.usWinAscent=i.readUshort(r,e),e+=2,a.usWinDescent=i.readUshort(r,e),e+=2},t["OS/2"].version1=function(r,e,a){var i=t._bin;return e=t["OS/2"].version0(r,e,a),a.ulCodePageRange1=i.readUint(r,e),e+=4,a.ulCodePageRange2=i.readUint(r,e),e+=4},t["OS/2"].version2=function(r,e,a){var i=t._bin;return e=t["OS/2"].version1(r,e,a),a.sxHeight=i.readShort(r,e),e+=2,a.sCapHeight=i.readShort(r,e),e+=2,a.usDefault=i.readUshort(r,e),e+=2,a.usBreak=i.readUshort(r,e),e+=2,a.usMaxContext=i.readUshort(r,e),e+=2},t["OS/2"].version5=function(r,e,a){var i=t._bin;return e=t["OS/2"].version2(r,e,a),a.usLowerOpticalPointSize=i.readUshort(r,e),e+=2,a.usUpperOpticalPointSize=i.readUshort(r,e),e+=2},t.post={},t.post.parse=function(r,e,a){var i=t._bin,n={};return n.version=i.readFixed(r,e),e+=4,n.italicAngle=i.readFixed(r,e),e+=4,n.underlinePosition=i.readShort(r,e),e+=2,n.underlineThickness=i.readShort(r,e),e+=2,n},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(r,e){var a=r.cmap,i=-1;if(a.p0e4!=null?i=a.p0e4:a.p3e1!=null?i=a.p3e1:a.p1e0!=null?i=a.p1e0:a.p0e3!=null&&(i=a.p0e3),i==-1)throw"no familiar platform and encoding!";var n=a.tables[i];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var o=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){o=s;break}return o==-1||n.startCount[o]>e?0:65535&(n.idRangeOffset[o]!=0?n.glyphIdArray[e-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:e+n.idDelta[o])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var l=n.groups[s];if(l[0]<=e&&e<=l[1])return l[2]+(e-l[0])}return 0}throw"unknown cmap table format "+n.format},t.U.glyphToPath=function(r,e){var a={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[e]){var i=r.SVG.entries[e];return i==null?a:(typeof i=="string"&&(i=t.SVG.toPath(i),r.SVG.entries[e]=i),i)}if(r.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},o=r.CFF,s=r.CFF.Private;if(o.ROS){for(var l=0;o.FDSelect[l+2]<=e;)l+=2;s=o.FDArray[o.FDSelect[l+1]].Private}t.U._drawCFF(r.CFF.CharStrings[e],n,o,s,a)}else r.glyf&&t.U._drawGlyf(e,r,a);return a},t.U._drawGlyf=function(r,e,a){var i=e.glyf[r];i==null&&(i=e.glyf[r]=t.glyf._parseGlyf(e,r)),i!=null&&(i.noc>-1?t.U._simpleGlyph(i,a):t.U._compoGlyph(i,e,a))},t.U._simpleGlyph=function(r,e){for(var a=0;a<r.noc;a++){for(var i=a==0?0:r.endPts[a-1]+1,n=r.endPts[a],o=i;o<=n;o++){var s=o==i?n:o-1,l=o==n?i:o+1,u=1&r.flags[o],c=1&r.flags[s],g=1&r.flags[l],p=r.xs[o],m=r.ys[o];if(o==i)if(u){if(!c){t.U.P.moveTo(e,p,m);continue}t.U.P.moveTo(e,r.xs[s],r.ys[s])}else c?t.U.P.moveTo(e,r.xs[s],r.ys[s]):t.U.P.moveTo(e,(r.xs[s]+p)/2,(r.ys[s]+m)/2);u?c&&t.U.P.lineTo(e,p,m):g?t.U.P.qcurveTo(e,p,m,r.xs[l],r.ys[l]):t.U.P.qcurveTo(e,p,m,(p+r.xs[l])/2,(m+r.ys[l])/2)}t.U.P.closePath(e)}},t.U._compoGlyph=function(r,e,a){for(var i=0;i<r.parts.length;i++){var n={cmds:[],crds:[]},o=r.parts[i];t.U._drawGlyf(o.glyphIndex,e,n);for(var s=o.m,l=0;l<n.crds.length;l+=2){var u=n.crds[l],c=n.crds[l+1];a.crds.push(u*s.a+c*s.b+s.tx),a.crds.push(u*s.c+c*s.d+s.ty)}for(l=0;l<n.cmds.length;l++)a.cmds.push(n.cmds[l])}},t.U._getGlyphClass=function(r,e){var a=t._lctf.getInterval(e,r);return a==-1?0:e[a+2]},t.U._applySubs=function(r,e,a,i){for(var n=r.length-e-1,o=0;o<a.tabs.length;o++)if(a.tabs[o]!=null){var s,l=a.tabs[o];if(!l.coverage||(s=t._lctf.coverageIndex(l.coverage,r[e]))!=-1){if(a.ltype==1)r[e],l.fmt==1?r[e]=r[e]+l.delta:r[e]=l.newg[s];else if(a.ltype==4)for(var u=l.vals[s],c=0;c<u.length;c++){var g=u[c],p=g.chain.length;if(!(p>n)){for(var m=!0,G=0,S=0;S<p;S++){for(;r[e+G+(1+S)]==-1;)G++;g.chain[S]!=r[e+G+(1+S)]&&(m=!1)}if(m){for(r[e]=g.nglyph,S=0;S<p+G;S++)r[e+S+1]=-1;break}}}else if(a.ltype==5&&l.fmt==2)for(var T=t._lctf.getInterval(l.cDef,r[e]),y=l.cDef[T+2],k=l.scset[y],R=0;R<k.length;R++){var w=k[R],_=w.input;if(!(_.length>n)){for(m=!0,S=0;S<_.length;S++){var B=t._lctf.getInterval(l.cDef,r[e+1+S]);if(T==-1&&l.cDef[B+2]!=_[S]){m=!1;break}}if(m){var D=w.substLookupRecords;for(c=0;c<D.length;c+=2)D[c],D[c+1]}}}else if(a.ltype==6&&l.fmt==3){if(!t.U._glsCovered(r,l.backCvg,e-l.backCvg.length)||!t.U._glsCovered(r,l.inptCvg,e)||!t.U._glsCovered(r,l.ahedCvg,e+l.inptCvg.length))continue;var Y=l.lookupRec;for(R=0;R<Y.length;R+=2){T=Y[R];var b=i[Y[R+1]];t.U._applySubs(r,e+T,b,i)}}}}},t.U._glsCovered=function(r,e,a){for(var i=0;i<e.length;i++)if(t._lctf.coverageIndex(e[i],r[a+i])==-1)return!1;return!0},t.U.glyphsToPath=function(r,e,a){for(var i={cmds:[],crds:[]},n=0,o=0;o<e.length;o++){var s=e[o];if(s!=-1){for(var l=o<e.length-1&&e[o+1]!=-1?e[o+1]:0,u=t.U.glyphToPath(r,s),c=0;c<u.crds.length;c+=2)i.crds.push(u.crds[c]+n),i.crds.push(u.crds[c+1]);for(a&&i.cmds.push(a),c=0;c<u.cmds.length;c++)i.cmds.push(u.cmds[c]);a&&i.cmds.push("X"),n+=r.hmtx.aWidth[s],o<e.length-1&&(n+=t.U.getPairAdjustment(r,s,l))}}return i},t.U.P={},t.U.P.moveTo=function(r,e,a){r.cmds.push("M"),r.crds.push(e,a)},t.U.P.lineTo=function(r,e,a){r.cmds.push("L"),r.crds.push(e,a)},t.U.P.curveTo=function(r,e,a,i,n,o,s){r.cmds.push("C"),r.crds.push(e,a,i,n,o,s)},t.U.P.qcurveTo=function(r,e,a,i,n){r.cmds.push("Q"),r.crds.push(e,a,i,n)},t.U.P.closePath=function(r){r.cmds.push("Z")},t.U._drawCFF=function(r,e,a,i,n){for(var o=e.stack,s=e.nStems,l=e.haveWidth,u=e.width,c=e.open,g=0,p=e.x,m=e.y,G=0,S=0,T=0,y=0,k=0,R=0,w=0,_=0,B=0,D=0,Y={val:0,size:0};g<r.length;){t.CFF.getCharString(r,g,Y);var b=Y.val;if(g+=Y.size,b=="o1"||b=="o18")o.length%2!=0&&!l&&(u=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if(b=="o3"||b=="o23")o.length%2!=0&&!l&&(u=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if(b=="o4")o.length>1&&!l&&(u=o.shift()+i.nominalWidthX,l=!0),c&&t.U.P.closePath(n),m+=o.pop(),t.U.P.moveTo(n,p,m),c=!0;else if(b=="o5")for(;o.length>0;)p+=o.shift(),m+=o.shift(),t.U.P.lineTo(n,p,m);else if(b=="o6"||b=="o7")for(var E=o.length,C=b=="o6",H=0;H<E;H++){var W=o.shift();C?p+=W:m+=W,C=!C,t.U.P.lineTo(n,p,m)}else if(b=="o8"||b=="o24"){E=o.length;for(var q=0;q+6<=E;)G=p+o.shift(),S=m+o.shift(),T=G+o.shift(),y=S+o.shift(),p=T+o.shift(),m=y+o.shift(),t.U.P.curveTo(n,G,S,T,y,p,m),q+=6;b=="o24"&&(p+=o.shift(),m+=o.shift(),t.U.P.lineTo(n,p,m))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(S=m,T=(G=p+o.shift())+o.shift(),D=y=S+o.shift(),R=y,_=m,p=(w=(k=(B=T+o.shift())+o.shift())+o.shift())+o.shift(),t.U.P.curveTo(n,G,S,T,y,B,D),t.U.P.curveTo(n,k,R,w,_,p,m)),b=="o1235"&&(G=p+o.shift(),S=m+o.shift(),T=G+o.shift(),y=S+o.shift(),B=T+o.shift(),D=y+o.shift(),k=B+o.shift(),R=D+o.shift(),w=k+o.shift(),_=R+o.shift(),p=w+o.shift(),m=_+o.shift(),o.shift(),t.U.P.curveTo(n,G,S,T,y,B,D),t.U.P.curveTo(n,k,R,w,_,p,m)),b=="o1236"&&(G=p+o.shift(),S=m+o.shift(),T=G+o.shift(),D=y=S+o.shift(),R=y,w=(k=(B=T+o.shift())+o.shift())+o.shift(),_=R+o.shift(),p=w+o.shift(),t.U.P.curveTo(n,G,S,T,y,B,D),t.U.P.curveTo(n,k,R,w,_,p,m)),b=="o1237"&&(G=p+o.shift(),S=m+o.shift(),T=G+o.shift(),y=S+o.shift(),B=T+o.shift(),D=y+o.shift(),k=B+o.shift(),R=D+o.shift(),w=k+o.shift(),_=R+o.shift(),Math.abs(w-p)>Math.abs(_-m)?p=w+o.shift():m=_+o.shift(),t.U.P.curveTo(n,G,S,T,y,B,D),t.U.P.curveTo(n,k,R,w,_,p,m));else if(b=="o14"){if(o.length>0&&!l&&(u=o.shift()+a.nominalWidthX,l=!0),o.length==4){var ne=o.shift(),P=o.shift(),L=o.shift(),v=o.shift(),x=t.CFF.glyphBySE(a,L),F=t.CFF.glyphBySE(a,v);t.U._drawCFF(a.CharStrings[x],e,a,i,n),e.x=ne,e.y=P,t.U._drawCFF(a.CharStrings[F],e,a,i,n)}c&&(t.U.P.closePath(n),c=!1)}else if(b=="o19"||b=="o20")o.length%2!=0&&!l&&(u=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,l=!0,g+=s+7>>3;else if(b=="o21")o.length>2&&!l&&(u=o.shift()+i.nominalWidthX,l=!0),m+=o.pop(),p+=o.pop(),c&&t.U.P.closePath(n),t.U.P.moveTo(n,p,m),c=!0;else if(b=="o22")o.length>1&&!l&&(u=o.shift()+i.nominalWidthX,l=!0),p+=o.pop(),c&&t.U.P.closePath(n),t.U.P.moveTo(n,p,m),c=!0;else if(b=="o25"){for(;o.length>6;)p+=o.shift(),m+=o.shift(),t.U.P.lineTo(n,p,m);G=p+o.shift(),S=m+o.shift(),T=G+o.shift(),y=S+o.shift(),p=T+o.shift(),m=y+o.shift(),t.U.P.curveTo(n,G,S,T,y,p,m)}else if(b=="o26")for(o.length%2&&(p+=o.shift());o.length>0;)G=p,S=m+o.shift(),p=T=G+o.shift(),m=(y=S+o.shift())+o.shift(),t.U.P.curveTo(n,G,S,T,y,p,m);else if(b=="o27")for(o.length%2&&(m+=o.shift());o.length>0;)S=m,T=(G=p+o.shift())+o.shift(),y=S+o.shift(),p=T+o.shift(),m=y,t.U.P.curveTo(n,G,S,T,y,p,m);else if(b=="o10"||b=="o29"){var A=b=="o10"?i:a;if(o.length==0)console.debug("error: empty stack");else{var U=o.pop(),j=A.Subrs[U+A.Bias];e.x=p,e.y=m,e.nStems=s,e.haveWidth=l,e.width=u,e.open=c,t.U._drawCFF(j,e,a,i,n),p=e.x,m=e.y,s=e.nStems,l=e.haveWidth,u=e.width,c=e.open}}else if(b=="o30"||b=="o31"){var M=o.length,I=(q=0,b=="o31");for(q+=M-(E=-3&M);q<E;)I?(S=m,T=(G=p+o.shift())+o.shift(),m=(y=S+o.shift())+o.shift(),E-q==5?(p=T+o.shift(),q++):p=T,I=!1):(G=p,S=m+o.shift(),T=G+o.shift(),y=S+o.shift(),p=T+o.shift(),E-q==5?(m=y+o.shift(),q++):m=y,I=!0),t.U.P.curveTo(n,G,S,T,y,p,m),q+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,r),b;o.push(b)}}}e.x=p,e.y=m,e.nStems=s,e.haveWidth=l,e.width=u,e.open=c};var d=t,h={Typr:d};return f.Typr=d,f.default=h,Object.defineProperty(f,"__esModule",{value:!0}),f}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Ma(){return function(f){var t=Uint8Array,d=Uint16Array,h=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(b,E){for(var C=new d(31),H=0;H<31;++H)C[H]=E+=1<<b[H-1];var W=new h(C[30]);for(H=1;H<30;++H)for(var q=C[H];q<C[H+1];++q)W[q]=q-C[H]<<5|H;return[C,W]},n=i(r,2),o=n[0],s=n[1];o[28]=258,s[258]=28;for(var l=i(e,0)[0],u=new d(32768),c=0;c<32768;++c){var g=(43690&c)>>>1|(21845&c)<<1;g=(61680&(g=(52428&g)>>>2|(13107&g)<<2))>>>4|(3855&g)<<4,u[c]=((65280&g)>>>8|(255&g)<<8)>>>1}var p=function(b,E,C){for(var H=b.length,W=0,q=new d(E);W<H;++W)++q[b[W]-1];var ne,P=new d(E);for(W=0;W<E;++W)P[W]=P[W-1]+q[W-1]<<1;{ne=new d(1<<E);var L=15-E;for(W=0;W<H;++W)if(b[W])for(var v=W<<4|b[W],x=E-b[W],F=P[b[W]-1]++<<x,A=F|(1<<x)-1;F<=A;++F)ne[u[F]>>>L]=v}return ne},m=new t(288);for(c=0;c<144;++c)m[c]=8;for(c=144;c<256;++c)m[c]=9;for(c=256;c<280;++c)m[c]=7;for(c=280;c<288;++c)m[c]=8;var G=new t(32);for(c=0;c<32;++c)G[c]=5;var S=p(m,9),T=p(G,5),y=function(b){for(var E=b[0],C=1;C<b.length;++C)b[C]>E&&(E=b[C]);return E},k=function(b,E,C){var H=E/8|0;return(b[H]|b[H+1]<<8)>>(7&E)&C},R=function(b,E){var C=E/8|0;return(b[C]|b[C+1]<<8|b[C+2]<<16)>>(7&E)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_=function(b,E,C){var H=new Error(E||w[b]);if(H.code=b,Error.captureStackTrace&&Error.captureStackTrace(H,_),!C)throw H;return H},B=function(b,E,C){var H=b.length;if(!H||C&&!C.l&&H<5)return E||new t(0);var W=!E||C,q=!C||C.i;C||(C={}),E||(E=new t(3*H));var ne,P=function(fe){var De=E.length;if(fe>De){var Te=new t(Math.max(2*De,fe));Te.set(E),E=Te}},L=C.f||0,v=C.p||0,x=C.b||0,F=C.l,A=C.d,U=C.m,j=C.n,M=8*H;do{if(!F){C.f=L=k(b,v,1);var I=k(b,v+1,3);if(v+=3,!I){var K=b[($=((ne=v)/8|0)+(7&ne&&1)+4)-4]|b[$-3]<<8,ee=$+K;if(ee>H){q&&_(0);break}W&&P(x+K),E.set(b.subarray($,ee),x),C.b=x+=K,C.p=v=8*ee;continue}if(I==1)F=S,A=T,U=9,j=5;else if(I==2){var V=k(b,v,31)+257,N=k(b,v+10,15)+4,ge=V+k(b,v+5,31)+1;v+=14;for(var ce=new t(ge),Z=new t(19),re=0;re<N;++re)Z[a[re]]=k(b,v+3*re,7);v+=3*N;var le=y(Z),z=(1<<le)-1,te=p(Z,le);for(re=0;re<ge;){var $,O=te[k(b,v,z)];if(v+=15&O,($=O>>>4)<16)ce[re++]=$;else{var de=0,Q=0;for($==16?(Q=3+k(b,v,3),v+=2,de=ce[re-1]):$==17?(Q=3+k(b,v,7),v+=3):$==18&&(Q=11+k(b,v,127),v+=7);Q--;)ce[re++]=de}}var oe=ce.subarray(0,V),J=ce.subarray(V);U=y(oe),j=y(J),F=p(oe,U),A=p(J,j)}else _(1);if(v>M){q&&_(0);break}}W&&P(x+131072);for(var xe=(1<<U)-1,ae=(1<<j)-1,ie=v;;ie=v){var ue=(de=F[R(b,v)&xe])>>>4;if((v+=15&de)>M){q&&_(0);break}if(de||_(2),ue<256)E[x++]=ue;else{if(ue==256){ie=v,F=null;break}var ve=ue-254;if(ue>264){var ke=r[re=ue-257];ve=k(b,v,(1<<ke)-1)+o[re],v+=ke}var Ae=A[R(b,v)&ae],me=Ae>>>4;if(Ae||_(3),v+=15&Ae,J=l[me],me>3&&(ke=e[me],J+=R(b,v)&(1<<ke)-1,v+=ke),v>M){q&&_(0);break}W&&P(x+131072);for(var ye=x+ve;x<ye;x+=4)E[x]=E[x-J],E[x+1]=E[x+1-J],E[x+2]=E[x+2-J],E[x+3]=E[x+3-J];x=ye}}C.l=F,C.p=ie,C.b=x,F&&(L=1,C.m=U,C.d=A,C.n=j)}while(!L);return x==E.length?E:function(fe,De,Te){(Te==null||Te>fe.length)&&(Te=fe.length);var Be=new(fe instanceof d?d:fe instanceof h?h:t)(Te-De);return Be.set(fe.subarray(De,Te)),Be}(E,0,x)},D=new t(0),Y=typeof TextDecoder<"u"&&new TextDecoder;try{Y.decode(D,{stream:!0})}catch{}return f.convert_streams=function(b){var E=new DataView(b),C=0;function H(){var V=E.getUint16(C);return C+=2,V}function W(){var V=E.getUint32(C);return C+=4,V}function q(V){K.setUint16(ee,V),ee+=2}function ne(V){K.setUint32(ee,V),ee+=4}for(var P={signature:W(),flavor:W(),length:W(),numTables:H(),reserved:H(),totalSfntSize:W(),majorVersion:H(),minorVersion:H(),metaOffset:W(),metaLength:W(),metaOrigLength:W(),privOffset:W(),privLength:W()},L=0;Math.pow(2,L)<=P.numTables;)L++;L--;for(var v=16*Math.pow(2,L),x=16*P.numTables-v,F=12,A=[],U=0;U<P.numTables;U++)A.push({tag:W(),offset:W(),compLength:W(),origLength:W(),origChecksum:W()}),F+=16;var j,M=new Uint8Array(12+16*A.length+A.reduce(function(V,N){return V+N.origLength+4},0)),I=M.buffer,K=new DataView(I),ee=0;return ne(P.flavor),q(P.numTables),q(v),q(L),q(x),A.forEach(function(V){ne(V.tag),ne(V.origChecksum),ne(F),ne(V.origLength),V.outOffset=F,(F+=V.origLength)%4!=0&&(F+=4-F%4)}),A.forEach(function(V){var N,ge=b.slice(V.offset,V.offset+V.compLength);if(V.compLength!=V.origLength){var ce=new Uint8Array(V.origLength);N=new Uint8Array(ge,2),B(N,ce)}else ce=new Uint8Array(ge);M.set(ce,V.outOffset);var Z=0;(F=V.outOffset+V.origLength)%4!=0&&(Z=4-F%4),M.set(new Uint8Array(Z).buffer,V.outOffset+V.origLength),j=F+Z}),I.slice(0,j)},Object.defineProperty(f,"__esModule",{value:!0}),f}({}).convert_streams}function Ra(f,t){const d={M:2,L:2,Q:4,C:6,Z:0},h={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,e=2,a=4,i=8,n=16,o=32;let s;function l(w){if(!s){const _={R:e,L:r,D:a,C:n,U:o,T:i};s=new Map;for(let B in h){let D=0;h[B].split(",").forEach(Y=>{let[b,E]=Y.split("+");b=parseInt(b,36),E=E?parseInt(E,36):0,s.set(D+=b,_[B]);for(let C=E;C--;)s.set(++D,_[B])})}}return s.get(w)||o}const u=1,c=2,g=3,p=4,m=[null,"isol","init","fina","medi"];function G(w){const _=new Uint8Array(w.length);let B=o,D=u,Y=-1;for(let b=0;b<w.length;b++){const E=w.codePointAt(b);let C=l(E)|0,H=u;C&i||(B&(r|a|n)?C&(e|a|n)?(H=g,(D===u||D===g)&&_[Y]++):C&(r|o)&&(D===c||D===p)&&_[Y]--:B&(e|o)&&(D===c||D===p)&&_[Y]--,D=_[b]=H,B=C,Y=b,E>65535&&b++)}return _}function S(w,_){const B=[];for(let Y=0;Y<_.length;Y++){const b=_.codePointAt(Y);b>65535&&Y++,B.push(f.U.codeToGlyph(w,b))}const D=w.GSUB;if(D){const{lookupList:Y,featureList:b}=D;let E;const C=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,H=[];b.forEach(W=>{if(C.test(W.tag))for(let q=0;q<W.tab.length;q++){if(H[W.tab[q]])continue;H[W.tab[q]]=!0;const ne=Y[W.tab[q]],P=/^(isol|init|fina|medi)$/.test(W.tag);P&&!E&&(E=G(_));for(let L=0;L<B.length;L++)(!E||!P||m[E[L]]===W.tag)&&f.U._applySubs(B,L,ne,Y)}})}return B}function T(w,_){const B=new Int16Array(_.length*3);let D=0;for(;D<_.length;D++){const C=_[D];if(C===-1)continue;B[D*3+2]=w.hmtx.aWidth[C];const H=w.GPOS;if(H){const W=H.lookupList;for(let q=0;q<W.length;q++){const ne=W[q];for(let P=0;P<ne.tabs.length;P++){const L=ne.tabs[P];if(ne.ltype===1){if(f._lctf.coverageIndex(L.coverage,C)!==-1&&L.pos){E(L.pos,D);break}}else if(ne.ltype===2){let v=null,x=Y();if(x!==-1){const F=f._lctf.coverageIndex(L.coverage,_[x]);if(F!==-1){if(L.fmt===1){const A=L.pairsets[F];for(let U=0;U<A.length;U++)A[U].gid2===C&&(v=A[U])}else if(L.fmt===2){const A=f.U._getGlyphClass(_[x],L.classDef1),U=f.U._getGlyphClass(C,L.classDef2);v=L.matrix[A][U]}if(v){v.val1&&E(v.val1,x),v.val2&&E(v.val2,D);break}}}}else if(ne.ltype===4){const v=f._lctf.coverageIndex(L.markCoverage,C);if(v!==-1){const x=Y(b),F=x===-1?-1:f._lctf.coverageIndex(L.baseCoverage,_[x]);if(F!==-1){const A=L.markArray[v],U=L.baseArray[F][A.markClass];B[D*3]=U.x-A.x+B[x*3]-B[x*3+2],B[D*3+1]=U.y-A.y+B[x*3+1];break}}}else if(ne.ltype===6){const v=f._lctf.coverageIndex(L.mark1Coverage,C);if(v!==-1){const x=Y();if(x!==-1){const F=_[x];if(y(w,F)===3){const A=f._lctf.coverageIndex(L.mark2Coverage,F);if(A!==-1){const U=L.mark1Array[v],j=L.mark2Array[A][U.markClass];B[D*3]=j.x-U.x+B[x*3]-B[x*3+2],B[D*3+1]=j.y-U.y+B[x*3+1];break}}}}}}}}else if(w.kern&&!w.cff){const W=Y();if(W!==-1){const q=w.kern.glyph1.indexOf(_[W]);if(q!==-1){const ne=w.kern.rval[q].glyph2.indexOf(C);ne!==-1&&(B[W*3+2]+=w.kern.rval[q].vals[ne])}}}}return B;function Y(C){for(let H=D-1;H>=0;H--)if(_[H]!==-1&&(!C||C(_[H])))return H;return-1}function b(C){return y(w,C)===1}function E(C,H){for(let W=0;W<3;W++)B[H*3+W]+=C[W]||0}}function y(w,_){const B=w.GDEF&&w.GDEF.glyphClassDef;return B?f.U._getGlyphClass(_,B):0}function k(...w){for(let _=0;_<w.length;_++)if(typeof w[_]=="number")return w[_]}function R(w){const _=Object.create(null),B=w["OS/2"],D=w.hhea,Y=w.head.unitsPerEm,b=k(B&&B.sTypoAscender,D&&D.ascender,Y),E={unitsPerEm:Y,ascender:b,descender:k(B&&B.sTypoDescender,D&&D.descender,0),capHeight:k(B&&B.sCapHeight,b),xHeight:k(B&&B.sxHeight,b),lineGap:k(B&&B.sTypoLineGap,D&&D.lineGap),supportsCodePoint(C){return f.U.codeToGlyph(w,C)>0},forEachGlyph(C,H,W,q){let ne=0;const P=1/E.unitsPerEm*H,L=S(w,C);let v=0;const x=T(w,L);return L.forEach((F,A)=>{if(F!==-1){let U=_[F];if(!U){const{cmds:j,crds:M}=f.U.glyphToPath(w,F);let I="",K=0;for(let ce=0,Z=j.length;ce<Z;ce++){const re=d[j[ce]];I+=j[ce];for(let le=1;le<=re;le++)I+=(le>1?",":"")+M[K++]}let ee,V,N,ge;if(M.length){ee=V=1/0,N=ge=-1/0;for(let ce=0,Z=M.length;ce<Z;ce+=2){let re=M[ce],le=M[ce+1];re<ee&&(ee=re),le<V&&(V=le),re>N&&(N=re),le>ge&&(ge=le)}}else ee=N=V=ge=0;U=_[F]={index:F,advanceWidth:w.hmtx.aWidth[F],xMin:ee,yMin:V,xMax:N,yMax:ge,path:I}}q.call(null,U,ne+x[A*3]*P,x[A*3+1]*P,v),ne+=x[A*3+2]*P,W&&(ne+=W*H)}v+=C.codePointAt(v)>65535?2:1}),ne}};return E}return function(_){const B=new Uint8Array(_,0,4),D=f._bin.readASCII(B,0,4);if(D==="wOFF")_=t(_);else if(D==="wOF2")throw new Error("woff2 fonts not supported");return R(f.parse(_)[0])}}const Ga=dr({name:"Typr Font Parser",dependencies:[Ea,Ma,Ra],init(f,t,d){const h=f(),r=t();return d(h,r)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function La(){return function(f){var t=function(){this.buckets=new Map};t.prototype.add=function(T){var y=T>>5;this.buckets.set(y,(this.buckets.get(y)||0)|1<<(31&T))},t.prototype.has=function(T){var y=this.buckets.get(T>>5);return y!==void 0&&(y&1<<(31&T))!=0},t.prototype.serialize=function(){var T=[];return this.buckets.forEach(function(y,k){T.push((+k).toString(36)+":"+y.toString(36))}),T.join(",")},t.prototype.deserialize=function(T){var y=this;this.buckets.clear(),T.split(",").forEach(function(k){var R=k.split(":");y.buckets.set(parseInt(R[0],36),parseInt(R[1],36))})};var d=Math.pow(2,8),h=d-1,r=~h;function e(T){var y=function(R){return R&r}(T).toString(16),k=function(R){return(R&r)+d-1}(T).toString(16);return"codepoint-index/plane"+(T>>16)+"/"+y+"-"+k+".json"}function a(T,y){var k=T&h,R=y.codePointAt(k/6|0);return((R=(R||48)-48)&1<<k%6)!=0}function i(T,y){var k;(k=T,k.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(R){return R.split("-").map(function(w){return parseInt(w.trim(),16)})})).forEach(function(R){var w=R[0],_=R[1];_===void 0&&(_=w),y(w,_)})}function n(T,y){i(T,function(k,R){for(var w=k;w<=R;w++)y(w)})}var o={},s={},l=new WeakMap,u="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function c(T){var y=l.get(T);return y||(y=new t,n(T.ranges,function(k){return y.add(k)}),l.set(T,y)),y}var g,p=new Map;function m(T,y,k){return T[y]?y:T[k]?k:function(R){for(var w in R)return w}(T)}function G(T,y){var k=y;if(!T.includes(k)){k=1/0;for(var R=0;R<T.length;R++)Math.abs(T[R]-y)<Math.abs(k-y)&&(k=T[R])}return k}function S(T){return g||(g=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(y){g.add(y)})),g.has(T)}return f.CodePointSet=t,f.clearCache=function(){o={},s={}},f.getFontsForString=function(T,y){y===void 0&&(y={});var k,R=y.lang;R===void 0&&(R=new RegExp("\\p{Script=Hangul}","u").test(k=T)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(k)?"ja":"en");var w=y.category;w===void 0&&(w="sans-serif");var _=y.style;_===void 0&&(_="normal");var B=y.weight;B===void 0&&(B=400);var D=(y.dataUrl||u).replace(/\/$/g,""),Y=new Map,b=new Uint8Array(T.length),E={},C={},H=new Array(T.length),W=new Map,q=!1;function ne(v){var x=p.get(v);return x||(x=fetch(D+"/"+v).then(function(F){if(!F.ok)throw new Error(F.statusText);return F.json().then(function(A){if(!Array.isArray(A)||A[0]!==1)throw new Error("Incorrect schema version; need 1, got "+A[0]);return A[1]})}).catch(function(F){if(D!==u)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+D+'", trying default CDN. '+F.message),q=!0),D=u,p.delete(v),ne(v);throw F}),p.set(v,x)),x}for(var P=function(v){var x=T.codePointAt(v),F=e(x);H[v]=F,o[F]||W.has(F)||W.set(F,ne(F).then(function(A){o[F]=A})),x>65535&&(v++,L=v)},L=0;L<T.length;L++)P(L);return Promise.all(W.values()).then(function(){W.clear();for(var v=function(F){var A=T.codePointAt(F),U=null,j=o[H[F]],M=void 0;for(var I in j){var K=C[I];if(K===void 0&&(K=C[I]=new RegExp(I).test(R||"en")),K){for(var ee in M=I,j[I])if(a(A,j[I][ee])){U=ee;break}break}}if(!U){e:for(var V in j)if(V!==M){for(var N in j[V])if(a(A,j[V][N])){U=N;break e}}}U||(console.debug("No font coverage for U+"+A.toString(16)),U="latin"),H[F]=U,s[U]||W.has(U)||W.set(U,ne("font-meta/"+U+".json").then(function(ge){s[U]=ge})),A>65535&&(F++,x=F)},x=0;x<T.length;x++)v(x);return Promise.all(W.values())}).then(function(){for(var v,x=null,F=0;F<T.length;F++){var A=T.codePointAt(F);if(x&&(S(A)||c(x).has(A)))b[F]=b[F-1];else{x=s[H[F]];var U=E[x.id];if(!U){var j=x.typeforms,M=m(j,w,"sans-serif"),I=m(j[M],_,"normal"),K=G((v=j[M])===null||v===void 0?void 0:v[I],B);U=E[x.id]=D+"/font-files/"+x.id+"/"+M+"."+I+"."+K+".woff"}var ee=Y.get(U);ee==null&&(ee=Y.size,Y.set(U,ee)),b[F]=ee}A>65535&&(F++,b[F]=b[F-1])}return{fontUrls:Array.from(Y.keys()),chars:b}})},Object.defineProperty(f,"__esModule",{value:!0}),f}({})}function Oa(f,t){const d=Object.create(null),h=Object.create(null);function r(a,i){const n=o=>{console.error(`Failure loading font ${a}`,o)};try{const o=new XMLHttpRequest;o.open("get",a,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)n(new Error(o.statusText));else if(o.status>0)try{const s=f(o.response);s.src=a,i(s)}catch(s){n(s)}},o.onerror=n,o.send()}catch(o){n(o)}}function e(a,i){let n=d[a];n?i(n):h[a]?h[a].push(i):(h[a]=[i],r(a,o=>{o.src=a,d[a]=o,h[a].forEach(s=>s(o)),delete h[a]}))}return function(a,i,{lang:n,fonts:o=[],style:s="normal",weight:l="normal",unicodeFontsURL:u}={}){const c=new Uint8Array(a.length),g=[];a.length||S();const p=new Map,m=[];if(s!=="italic"&&(s="normal"),typeof l!="number"&&(l=l==="bold"?700:400),o&&!Array.isArray(o)&&(o=[o]),o=o.slice().filter(y=>!y.lang||y.lang.test(n)).reverse(),o.length){let w=0;(function _(B=0){for(let D=B,Y=a.length;D<Y;D++){const b=a.codePointAt(D);if(w===1&&g[c[D-1]].supportsCodePoint(b)||D>0&&/\s/.test(a[D]))c[D]=c[D-1],w===2&&(m[m.length-1][1]=D);else for(let E=c[D],C=o.length;E<=C;E++)if(E===C){const H=w===2?m[m.length-1]:m[m.length]=[D,D];H[1]=D,w=2}else{c[D]=E;const{src:H,unicodeRange:W}=o[E];if(!W||T(b,W)){const q=d[H];if(!q){e(H,()=>{_(D)});return}if(q.supportsCodePoint(b)){let ne=p.get(q);typeof ne!="number"&&(ne=g.length,g.push(q),p.set(q,ne)),c[D]=ne,w=1;break}}}b>65535&&D+1<Y&&(c[D+1]=c[D],D++,w===2&&(m[m.length-1][1]=D))}G()})()}else m.push([0,a.length-1]),G();function G(){if(m.length){const y=m.map(k=>a.substring(k[0],k[1]+1)).join(`
`);t.getFontsForString(y,{lang:n||void 0,style:s,weight:l,dataUrl:u}).then(({fontUrls:k,chars:R})=>{const w=g.length;let _=0;m.forEach(D=>{for(let Y=0,b=D[1]-D[0];Y<=b;Y++)c[D[0]+Y]=R[_++]+w;_++});let B=0;k.forEach((D,Y)=>{e(D,b=>{g[Y+w]=b,++B===k.length&&S()})})})}else S()}function S(){i({chars:c,fonts:g})}function T(y,k){for(let R=0;R<k.length;R++){const[w,_=w]=k[R];if(w<=y&&y<=_)return!0}return!1}}}const Ba=dr({name:"FontResolver",dependencies:[Oa,Ga,La],init(f,t,d){return f(t,d())}});function Pa(f,t){const h=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",e=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:g,lang:p,fonts:m,style:G,weight:S,preResolvedFonts:T,unicodeFontsURL:y},k){const R=({chars:w,fonts:_})=>{let B,D;const Y=[];for(let b=0;b<w.length;b++)w[b]!==D?(D=w[b],Y.push(B={start:b,end:b,fontObj:_[w[b]]})):B.end=b;k(Y)};T?R(T):f(g,R,{lang:p,fonts:m,style:G,weight:S,unicodeFontsURL:y})}function i({text:g="",font:p,lang:m,sdfGlyphSize:G=64,fontSize:S=400,fontWeight:T=1,fontStyle:y="normal",letterSpacing:k=0,lineHeight:R="normal",maxWidth:w=1/0,direction:_,textAlign:B="left",textIndent:D=0,whiteSpace:Y="normal",overflowWrap:b="normal",anchorX:E=0,anchorY:C=0,metricsOnly:H=!1,unicodeFontsURL:W,preResolvedFonts:q=null,includeCaretPositions:ne=!1,chunkedBoundsSize:P=8192,colorRanges:L=null},v){const x=l(),F={fontLoad:0,typesetting:0};g.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),g=g.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),S=+S,k=+k,w=+w,R=R||"normal",D=+D,a({text:g,lang:m,style:y,weight:T,fonts:typeof p=="string"?[{src:p}]:p,unicodeFontsURL:W,preResolvedFonts:q},A=>{F.fontLoad=l()-x;const U=isFinite(w);let j=null,M=null,I=null,K=null,ee=null,V=null,N=null,ge=null,ce=0,Z=0,re=Y!=="nowrap";const le=new Map,z=l();let te=D,$=0,O=new u;const de=[O];A.forEach(ae=>{const{fontObj:ie}=ae,{ascender:ue,descender:ve,unitsPerEm:ke,lineGap:Ae,capHeight:me,xHeight:ye}=ie;let fe=le.get(ie);if(!fe){const he=S/ke,we=R==="normal"?(ue-ve+Ae)*he:R*S,Je=(we-(ue-ve)*he)/2,Ue=Math.min(we,(ue-ve)*he),be=(ue+ve)/2*he+Ue/2;fe={index:le.size,src:ie.src,fontObj:ie,fontSizeMult:he,unitsPerEm:ke,ascender:ue*he,descender:ve*he,capHeight:me*he,xHeight:ye*he,lineHeight:we,baseline:-Je-ue*he,caretTop:be,caretBottom:be-Ue},le.set(ie,fe)}const{fontSizeMult:De}=fe,Te=g.slice(ae.start,ae.end+1);let Be,_e;ie.forEachGlyph(Te,S,k,(he,we,Je,Ue)=>{we+=$,Ue+=ae.start,Be=we,_e=he;const be=g.charAt(Ue),Ee=he.advanceWidth*De,Fe=O.count;let pe;if("isEmpty"in he||(he.isWhitespace=!!be&&new RegExp(r).test(be),he.canBreakAfter=!!be&&e.test(be),he.isEmpty=he.xMin===he.xMax||he.yMin===he.yMax||h.test(be)),!he.isWhitespace&&!he.isEmpty&&Z++,re&&U&&!he.isWhitespace&&we+Ee+te>w&&Fe){if(O.glyphAt(Fe-1).glyphObj.canBreakAfter)pe=new u,te=-we;else for(let Le=Fe;Le--;)if(Le===0&&b==="break-word"){pe=new u,te=-we;break}else if(O.glyphAt(Le).glyphObj.canBreakAfter){pe=O.splitAt(Le+1);const Ge=pe.glyphAt(0).x;te-=Ge;for(let Me=pe.count;Me--;)pe.glyphAt(Me).x-=Ge;break}pe&&(O.isSoftWrapped=!0,O=pe,de.push(O),ce=w)}let Ce=O.glyphAt(O.count);Ce.glyphObj=he,Ce.x=we+te,Ce.y=Je,Ce.width=Ee,Ce.charIndex=Ue,Ce.fontData=fe,be===`
`&&(O=new u,de.push(O),te=-(we+Ee+k*S)+D)}),$=Be+_e.advanceWidth*De+k*S});let Q=0;de.forEach(ae=>{let ie=!0;for(let ue=ae.count;ue--;){const ve=ae.glyphAt(ue);ie&&!ve.glyphObj.isWhitespace&&(ae.width=ve.x+ve.width,ae.width>ce&&(ce=ae.width),ie=!1);let{lineHeight:ke,capHeight:Ae,xHeight:me,baseline:ye}=ve.fontData;ke>ae.lineHeight&&(ae.lineHeight=ke);const fe=ye-ae.baseline;fe<0&&(ae.baseline+=fe,ae.cap+=fe,ae.ex+=fe),ae.cap=Math.max(ae.cap,ae.baseline+Ae),ae.ex=Math.max(ae.ex,ae.baseline+me)}ae.baseline-=Q,ae.cap-=Q,ae.ex-=Q,Q+=ae.lineHeight});let oe=0,J=0;if(E&&(typeof E=="number"?oe=-E:typeof E=="string"&&(oe=-ce*(E==="left"?0:E==="center"?.5:E==="right"?1:o(E)))),C&&(typeof C=="number"?J=-C:typeof C=="string"&&(J=C==="top"?0:C==="top-baseline"?-de[0].baseline:C==="top-cap"?-de[0].cap:C==="top-ex"?-de[0].ex:C==="middle"?Q/2:C==="bottom"?Q:C==="bottom-baseline"?-de[de.length-1].baseline:o(C)*Q)),!H){const ae=t.getEmbeddingLevels(g,_);j=new Uint16Array(Z),M=new Uint8Array(Z),I=new Float32Array(Z*2),K={},N=[1/0,1/0,-1/0,-1/0],ge=[],ne&&(V=new Float32Array(g.length*4)),L&&(ee=new Uint8Array(Z*3));let ie=0,ue=-1,ve=-1,ke,Ae;if(de.forEach((me,ye)=>{let{count:fe,width:De}=me;if(fe>0){let Te=0;for(let Ue=fe;Ue--&&me.glyphAt(Ue).glyphObj.isWhitespace;)Te++;let Be=0,_e=0;if(B==="center")Be=(ce-De)/2;else if(B==="right")Be=ce-De;else if(B==="justify"&&me.isSoftWrapped){let Ue=0;for(let be=fe-Te;be--;)me.glyphAt(be).glyphObj.isWhitespace&&Ue++;_e=(ce-De)/Ue}if(_e||Be){let Ue=0;for(let be=0;be<fe;be++){let Ee=me.glyphAt(be);const Fe=Ee.glyphObj;Ee.x+=Be+Ue,_e!==0&&Fe.isWhitespace&&be<fe-Te&&(Ue+=_e,Ee.width+=_e)}}const he=t.getReorderSegments(g,ae,me.glyphAt(0).charIndex,me.glyphAt(me.count-1).charIndex);for(let Ue=0;Ue<he.length;Ue++){const[be,Ee]=he[Ue];let Fe=1/0,pe=-1/0;for(let Ce=0;Ce<fe;Ce++)if(me.glyphAt(Ce).charIndex>=be){let Le=Ce,Ge=Ce;for(;Ge<fe;Ge++){let Me=me.glyphAt(Ge);if(Me.charIndex>Ee)break;Ge<fe-Te&&(Fe=Math.min(Fe,Me.x),pe=Math.max(pe,Me.x+Me.width))}for(let Me=Le;Me<Ge;Me++){const We=me.glyphAt(Me);We.x=pe-(We.x+We.width-Fe)}break}}let we;const Je=Ue=>we=Ue;for(let Ue=0;Ue<fe;Ue++){const be=me.glyphAt(Ue);we=be.glyphObj;const Ee=we.index,Fe=ae.levels[be.charIndex]&1;if(Fe){const pe=t.getMirroredCharacter(g[be.charIndex]);pe&&be.fontData.fontObj.forEachGlyph(pe,0,0,Je)}if(ne){const{charIndex:pe,fontData:Ce}=be,Le=be.x+oe,Ge=be.x+be.width+oe;V[pe*4]=Fe?Ge:Le,V[pe*4+1]=Fe?Le:Ge,V[pe*4+2]=me.baseline+Ce.caretBottom+J,V[pe*4+3]=me.baseline+Ce.caretTop+J;const Me=pe-ue;Me>1&&s(V,ue,Me),ue=pe}if(L){const{charIndex:pe}=be;for(;pe>ve;)ve++,L.hasOwnProperty(ve)&&(Ae=L[ve])}if(!we.isWhitespace&&!we.isEmpty){const pe=ie++,{fontSizeMult:Ce,src:Le,index:Ge}=be.fontData,Me=K[Le]||(K[Le]={});Me[Ee]||(Me[Ee]={path:we.path,pathBounds:[we.xMin,we.yMin,we.xMax,we.yMax]});const We=be.x+oe,Qe=be.y+me.baseline+J;I[pe*2]=We,I[pe*2+1]=Qe;const Ye=We+we.xMin*Ce,Ze=Qe+we.yMin*Ce,er=We+we.xMax*Ce,Ke=Qe+we.yMax*Ce;Ye<N[0]&&(N[0]=Ye),Ze<N[1]&&(N[1]=Ze),er>N[2]&&(N[2]=er),Ke>N[3]&&(N[3]=Ke),pe%P===0&&(ke={start:pe,end:pe,rect:[1/0,1/0,-1/0,-1/0]},ge.push(ke)),ke.end++;const Oe=ke.rect;if(Ye<Oe[0]&&(Oe[0]=Ye),Ze<Oe[1]&&(Oe[1]=Ze),er>Oe[2]&&(Oe[2]=er),Ke>Oe[3]&&(Oe[3]=Ke),j[pe]=Ee,M[pe]=Ge,L){const rr=pe*3;ee[rr]=Ae>>16&255,ee[rr+1]=Ae>>8&255,ee[rr+2]=Ae&255}}}}}),V){const me=g.length-ue;me>1&&s(V,ue,me)}}const xe=[];le.forEach(({index:ae,src:ie,unitsPerEm:ue,ascender:ve,descender:ke,lineHeight:Ae,capHeight:me,xHeight:ye})=>{xe[ae]={src:ie,unitsPerEm:ue,ascender:ve,descender:ke,lineHeight:Ae,capHeight:me,xHeight:ye}}),F.typesetting=l()-z,v({glyphIds:j,glyphFontIndices:M,glyphPositions:I,glyphData:K,fontData:xe,caretPositions:V,glyphColors:ee,chunkedBounds:ge,fontSize:S,topBaseline:J+de[0].baseline,blockBounds:[oe,J-Q,oe+ce,J],visibleBounds:N,timings:F})})}function n(g,p){i({...g,metricsOnly:!0},m=>{const[G,S,T,y]=m.blockBounds;p({width:T-G,height:y-S})})}function o(g){let p=g.match(/^([\d.]+)%$/),m=p?parseFloat(p[1]):NaN;return isNaN(m)?0:m/100}function s(g,p,m){const G=g[p*4],S=g[p*4+1],T=g[p*4+2],y=g[p*4+3],k=(S-G)/m;for(let R=0;R<m;R++){const w=(p+R)*4;g[w]=G+k*R,g[w+1]=G+k*(R+1),g[w+2]=T,g[w+3]=y}}function l(){return(self.performance||Date).now()}function u(){this.data=[]}const c=["glyphObj","x","y","width","charIndex","fontData"];return u.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/c.length)},glyphAt(g){let p=u.flyweight;return p.data=this.data,p.index=g,p},splitAt(g){let p=new u;return p.data=this.data.splice(g*c.length),p}},u.flyweight=c.reduce((g,p,m,G)=>(Object.defineProperty(g,p,{get(){return this.data[this.index*c.length+m]},set(S){this.data[this.index*c.length+m]=S}}),g),{data:null,index:0}),{typeset:i,measure:n}}const or=()=>(self.performance||Date).now(),Qr=wn();let ln;function Ia(f,t,d,h,r,e,a,i,n,o,s=!0){return s?Na(f,t,d,h,r,e,a,i,n,o).then(null,l=>(ln||(console.warn("WebGL SDF generation failed, falling back to JS",l),ln=!0),un(f,t,d,h,r,e,a,i,n,o))):un(f,t,d,h,r,e,a,i,n,o)}const Vr=[],ja=5;let _t=0;function Un(){const f=or();for(;Vr.length&&or()-f<ja;)Vr.shift()();_t=Vr.length?setTimeout(Un,0):0}const Na=(...f)=>new Promise((t,d)=>{Vr.push(()=>{const h=or();try{Qr.webgl.generateIntoCanvas(...f),t({timing:or()-h})}catch(r){d(r)}}),_t||(_t=setTimeout(Un,0))}),Wa=4,za=2e3,fn={};let Va=0;function un(f,t,d,h,r,e,a,i,n,o){const s="TroikaTextSDFGenerator_JS_"+Va++%Wa;let l=fn[s];return l||(l=fn[s]={workerModule:dr({name:s,workerId:s,dependencies:[wn,or],init(u,c){const g=u().javascript.generate;return function(...p){const m=c();return{textureData:g(...p),timing:c()-m}}},getTransferables(u){return[u.textureData.buffer]}}),requests:0,idleTimer:null}),l.requests++,clearTimeout(l.idleTimer),l.workerModule(f,t,d,h,r,e).then(({textureData:u,timing:c})=>{const g=or(),p=new Uint8Array(u.length*4);for(let m=0;m<u.length;m++)p[m*4+o]=u[m];return Qr.webglUtils.renderImageData(a,p,i,n,f,t,1<<3-o),c+=or()-g,--l.requests===0&&(l.idleTimer=setTimeout(()=>{wa(s)},za)),{timing:c}})}function Ha(f){f._warm||(Qr.webgl.isSupported(f),f._warm=!0)}const Xa=Qr.webglUtils.resizeWebGLCanvasWithoutClearing,_r={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Ya=new Kr;function ur(){return(self.performance||Date).now()}const cn=Object.create(null);function kn(f,t){f=Qa({},f);const d=ur(),h=[];if(f.font&&h.push({label:"user",src:Za(f.font)}),f.font=h,f.text=""+f.text,f.sdfGlyphSize=f.sdfGlyphSize||_r.sdfGlyphSize,f.unicodeFontsURL=f.unicodeFontsURL||_r.unicodeFontsURL,f.colorRanges!=null){let u={};for(let c in f.colorRanges)if(f.colorRanges.hasOwnProperty(c)){let g=f.colorRanges[c];typeof g!="number"&&(g=Ya.set(g).getHex()),u[c]=g}f.colorRanges=u}Object.freeze(f);const{textureWidth:r,sdfExponent:e}=_r,{sdfGlyphSize:a}=f,i=r/a*4;let n=cn[a];if(!n){const u=document.createElement("canvas");u.width=r,u.height=a*256/i,n=cn[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:u,sdfTexture:new Jn(u,void 0,void 0,void 0,en,en),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,Ka(n)}const{sdfTexture:o,sdfCanvas:s}=n;Fn(f).then(u=>{const{glyphIds:c,glyphFontIndices:g,fontData:p,glyphPositions:m,fontSize:G,timings:S}=u,T=[],y=new Float32Array(c.length*4);let k=0,R=0;const w=ur(),_=p.map(E=>{let C=n.glyphsByFont.get(E.src);return C||n.glyphsByFont.set(E.src,C=new Map),C});c.forEach((E,C)=>{const H=g[C],{src:W,unitsPerEm:q}=p[H];let ne=_[H].get(E);if(!ne){const{path:F,pathBounds:A}=u.glyphData[W][E],U=Math.max(A[2]-A[0],A[3]-A[1])/a*(_r.sdfMargin*a+.5),j=n.glyphCount++,M=[A[0]-U,A[1]-U,A[2]+U,A[3]+U];_[H].set(E,ne={path:F,atlasIndex:j,sdfViewBox:M}),T.push(ne)}const{sdfViewBox:P}=ne,L=m[R++],v=m[R++],x=G/q;y[k++]=L+P[0]*x,y[k++]=v+P[1]*x,y[k++]=L+P[2]*x,y[k++]=v+P[3]*x,c[C]=ne.atlasIndex}),S.quads=(S.quads||0)+(ur()-w);const B=ur();S.sdf={};const D=s.height,Y=Math.ceil(n.glyphCount/i),b=Math.pow(2,Math.ceil(Math.log2(Y*a)));b>D&&(console.info(`Increasing SDF texture size ${D}->${b}`),Xa(s,r,b),o.dispose()),Promise.all(T.map(E=>_n(E,n,f.gpuAccelerateSDF).then(({timing:C})=>{S.sdf[E.atlasIndex]=C}))).then(()=>{T.length&&!n.contextLost&&(Tn(n),o.needsUpdate=!0),S.sdfTotal=ur()-B,S.total=ur()-d,t(Object.freeze({parameters:f,sdfTexture:o,sdfGlyphSize:a,sdfExponent:e,glyphBounds:y,glyphAtlasIndices:c,glyphColors:u.glyphColors,caretPositions:u.caretPositions,chunkedBounds:u.chunkedBounds,ascender:u.ascender,descender:u.descender,lineHeight:u.lineHeight,capHeight:u.capHeight,xHeight:u.xHeight,topBaseline:u.topBaseline,blockBounds:u.blockBounds,visibleBounds:u.visibleBounds,timings:u.timings}))})}),Promise.resolve().then(()=>{n.contextLost||Ha(s)})}function _n({path:f,atlasIndex:t,sdfViewBox:d},{sdfGlyphSize:h,sdfCanvas:r,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:n}=_r,o=Math.max(d[2]-d[0],d[3]-d[1]),s=Math.floor(t/4),l=s%(i/h)*h,u=Math.floor(s/(i/h))*h,c=t%4;return Ia(h,h,f,d,o,n,r,l,u,c,a)}function Ka(f){const t=f.sdfCanvas;t.addEventListener("webglcontextlost",d=>{console.log("Context Lost",d),d.preventDefault(),f.contextLost=!0}),t.addEventListener("webglcontextrestored",d=>{console.log("Context Restored",d),f.contextLost=!1;const h=[];f.glyphsByFont.forEach(r=>{r.forEach(e=>{h.push(_n(e,f,!0))})}),Promise.all(h).then(()=>{Tn(f),f.sdfTexture.needsUpdate=!0})})}function Ja({font:f,characters:t,sdfGlyphSize:d},h){let r=Array.isArray(t)?t.join(`
`):""+t;kn({font:f,sdfGlyphSize:d,text:r},h)}function Qa(f,t){for(let d in t)t.hasOwnProperty(d)&&(f[d]=t[d]);return f}let Nr;function Za(f){return Nr||(Nr=typeof document>"u"?{}:document.createElement("a")),Nr.href=f,Nr.href}function Tn(f){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:d}=f,{width:h,height:r}=t,e=f.sdfCanvas.getContext("webgl");let a=d.image.data;(!a||a.length!==h*r*4)&&(a=new Uint8Array(h*r*4),d.image={width:h,height:r,data:a},d.flipY=!1,d.isDataTexture=!0),e.readPixels(0,0,h,r,e.RGBA,e.UNSIGNED_BYTE,a)}}const qa=dr({name:"Typesetter",dependencies:[Pa,Ba,Ua],init(f,t,d){return f(t,d())}}),Fn=dr({name:"Typesetter",dependencies:[qa],init(f){return function(t){return new Promise(d=>{f.typeset(t,d)})}},getTransferables(f){const t=[];for(let d in f)f[d]&&f[d].buffer&&t.push(f[d].buffer);return t}});Fn.onMainThread;const hn={};function $a(f){let t=hn[f];return t||(t=hn[f]=new Ft(1,1,f,f).translate(.5,.5,0)),t}const eo="aTroikaGlyphBounds",dn="aTroikaGlyphIndex",ro="aTroikaGlyphColor";class to extends Xn{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Yn,this.boundingBox=new bn}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let d=$a(t);["position","normal","uv"].forEach(h=>{this.attributes[h]=d.attributes[h].clone()}),this.setIndex(d.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,d,h,r,e){this.updateAttributeData(eo,t,4),this.updateAttributeData(dn,d,1),this.updateAttributeData(ro,e,3),this._blockBounds=h,this._chunkedBounds=r,this.instanceCount=d.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:d,boundingBox:h}=this;if(d){const{PI:r,floor:e,min:a,max:i,sin:n,cos:o}=Math,s=r/2,l=r*2,u=Math.abs(d),c=t[0]/u,g=t[2]/u,p=e((c+s)/l)!==e((g+s)/l)?-u:a(n(c)*u,n(g)*u),m=e((c-s)/l)!==e((g-s)/l)?u:i(n(c)*u,n(g)*u),G=e((c+r)/l)!==e((g+r)/l)?u*2:i(u-o(c)*u,u-o(g)*u);h.min.set(p,t[1],d<0?-G:0),h.max.set(m,t[3],d<0?0:G)}else h.min.set(t[0],t[1],0),h.max.set(t[2],t[3],0);h.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let d=this.getAttribute(dn).count,h=this._chunkedBounds;if(h)for(let r=h.length;r--;){d=h[r].end;let e=h[r].rect;if(e[1]<t.w&&e[3]>t.y&&e[0]<t.z&&e[2]>t.x)break}this.instanceCount=d}updateAttributeData(t,d,h){const r=this.getAttribute(t);d?r&&r.array.length===d.length?(r.array.set(d),r.needsUpdate=!0):(this.setAttribute(t,new Kn(d,h)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(t)}}const no=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,ao=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,oo=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,io=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function so(f){const t=kt(f,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Xr},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new rn(0,0,0,0)},uTroikaClipRect:{value:new rn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Xr},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Kr},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Qn},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:no,vertexTransform:ao,fragmentDefs:oo,fragmentColorTransform:io,customRewriter({vertexShader:d,fragmentShader:h}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(h)&&(h=h.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(d)||(d=d.replace(Sn,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:d,fragmentShader:h}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const Ct=new Vn({color:16777215,side:Zn,transparent:!0}),vn=8421504,pn=new Hn,Wr=new ar,yt=new ar,kr=[],lo=new ar,bt="+x+y";function gn(f){return Array.isArray(f)?f[0]:f}let Cn=()=>{const f=new Tt(new Ft(1,1),Ct);return Cn=()=>f,f},An=()=>{const f=new Tt(new Ft(1,1,32,1),Ct);return An=()=>f,f};const fo={type:"syncstart"},uo={type:"synccomplete"},Dn=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],co=Dn.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let En=class extends Tt{constructor(){const t=new to;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=vn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=bt,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(fo),kn({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},d=>{this._isSyncing=!1,this._textRenderInfo=d,this.geometry.updateGlyphs(d.glyphBounds,d.glyphAtlasIndices,d.blockBounds,d.chunkedBounds,d.glyphColors);const h=this._queuedSyncs;h&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{h.forEach(r=>r&&r())})),this.dispatchEvent(uo),t&&t()})))}onBeforeRender(t,d,h,r,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return so(t)}get material(){let t=this._derivedMaterial;const d=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Ct.clone());if((!t||!t.isDerivedFrom(d))&&(t=this._derivedMaterial=this.createDerivedMaterial(d),d.addEventListener("dispose",function h(){d.removeEventListener("dispose",h),t.dispose()})),this.hasOutline()){let h=t._outlineMtl;return h||(h=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),h.isTextOutlineMaterial=!0,h.depthWrite=!1,h.map=null,t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),h.dispose()})),[h,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return gn(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return gn(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const d=t.isTextOutlineMaterial,h=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:i,blockBounds:n}=r;h.uTroikaSDFTexture.value=i,h.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),h.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,h.uTroikaSDFExponent.value=r.sdfExponent,h.uTroikaTotalBounds.value.fromArray(n),h.uTroikaUseGlyphColors.value=!d&&!!r.glyphColors;let o=0,s=0,l=0,u,c,g,p=0,m=0;if(d){let{outlineWidth:S,outlineOffsetX:T,outlineOffsetY:y,outlineBlur:k,outlineOpacity:R}=this;o=this._parsePercent(S)||0,s=Math.max(0,this._parsePercent(k)||0),u=R,p=this._parsePercent(T)||0,m=this._parsePercent(y)||0}else l=Math.max(0,this._parsePercent(this.strokeWidth)||0),l&&(g=this.strokeColor,h.uTroikaStrokeColor.value.set(g??vn),c=this.strokeOpacity,c==null&&(c=1)),u=this.fillOpacity;h.uTroikaEdgeOffset.value=o,h.uTroikaPositionOffset.value.set(p,m),h.uTroikaBlurRadius.value=s,h.uTroikaStrokeWidth.value=l,h.uTroikaStrokeOpacity.value=c,h.uTroikaFillOpacity.value=u??1,h.uTroikaCurveRadius.value=this.curveRadius||0;let G=this.clipRect;if(G&&Array.isArray(G)&&G.length===4)h.uTroikaClipRect.value.fromArray(G);else{const S=(this.fontSize||.1)*100;h.uTroikaClipRect.value.set(n[0]-S,n[1]-S,n[2]+S,n[3]+S)}this.geometry.applyClipRect(h.uTroikaClipRect.value)}h.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const e=d?this.outlineColor||0:this.color;if(e==null)delete t.color;else{const i=t.hasOwnProperty("color")?t.color:t.color=new Kr;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let a=this.orientation||bt;if(a!==t._orientation){let i=h.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==bt&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,o,s,l,u]=n;Wr.set(0,0,0)[s]=o==="-"?1:-1,yt.set(0,0,0)[u]=l==="-"?-1:1,pn.lookAt(lo,Wr.cross(yt),yt),i.setFromMatrix4(pn)}else i.identity();t._orientation=a}}_parsePercent(t){if(typeof t=="string"){let d=t.match(/^(-?[\d.]+)%$/),h=d?parseFloat(d[1]):NaN;t=(isNaN(h)?0:h/100)*this.fontSize}return t}localPositionToTextCoords(t,d=new Xr){d.copy(t);const h=this.curveRadius;return h&&(d.x=Math.atan2(t.x,Math.abs(h)-Math.abs(t.z))*Math.abs(h)),d}worldPositionToTextCoords(t,d=new Xr){return Wr.copy(t),this.localPositionToTextCoords(this.worldToLocal(Wr),d)}raycast(t,d){const{textRenderInfo:h,curveRadius:r}=this;if(h){const e=h.blockBounds,a=r?An():Cn(),i=a.geometry,{position:n,uv:o}=i.attributes;for(let s=0;s<o.count;s++){let l=e[0]+o.getX(s)*(e[2]-e[0]);const u=e[1]+o.getY(s)*(e[3]-e[1]);let c=0;r&&(c=r-Math.cos(l/r)*r,l=Math.sin(l/r)*r),n.setXYZ(s,l,u,c)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,kr.length=0,a.raycast(t,kr);for(let s=0;s<kr.length;s++)kr[s].object=this,d.push(kr[s])}}copy(t){const d=this.geometry;return super.copy(t),this.geometry=d,co.forEach(h=>{this[h]=t[h]}),this}clone(){return new this.constructor().copy(this)}};Dn.forEach(f=>{const t="_private_"+f;Object.defineProperty(En.prototype,f,{get(){return this[t]},set(d){d!==this[t]&&(this[t]=d,this._needsSync=!0)}})});new bn;new Kr;const Hr=Se.forwardRef(({sdfGlyphSize:f=64,anchorX:t="center",anchorY:d="middle",font:h,fontSize:r=1,children:e,characters:a,onSync:i,...n},o)=>{const s=qn(({invalidate:g})=>g),[l]=Se.useState(()=>new En),[u,c]=Se.useMemo(()=>{const g=[];let p="";return Se.Children.forEach(e,m=>{typeof m=="string"||typeof m=="number"?p+=m:g.push(m)}),[g,p]},[e]);return $n(()=>new Promise(g=>Ja({font:h,characters:a},g)),["troika-text",h,a]),Se.useLayoutEffect(()=>void l.sync(()=>{s(),i&&i(l)})),Se.useEffect(()=>()=>l.dispose(),[l]),Se.createElement("primitive",ea({object:l,ref:o,font:h,text:c,anchorX:t,anchorY:d,fontSize:r,sdfGlyphSize:f},n),u)}),ho=Se.forwardRef(({children:f,enabled:t=!0,speed:d=1,rotationIntensity:h=1,floatIntensity:r=1,floatingRange:e=[-.1,.1],autoInvalidate:a=!1,...i},n)=>{const o=Se.useRef(null);Se.useImperativeHandle(n,()=>o.current,[]);const s=Se.useRef(Math.random()*1e4);return cr(l=>{var u,c;if(!t||d===0)return;a&&l.invalidate();const g=s.current+l.clock.elapsedTime;o.current.rotation.x=Math.cos(g/4*d)/8*h,o.current.rotation.y=Math.sin(g/4*d)/8*h,o.current.rotation.z=Math.sin(g/4*d)/20*h;let p=Math.sin(g/4*d)/10;p=ra.mapLinear(p,-.1,.1,(u=e==null?void 0:e[0])!==null&&u!==void 0?u:-.1,(c=e==null?void 0:e[1])!==null&&c!==void 0?c:.1),o.current.position.y=p*r,o.current.updateMatrix()}),Se.createElement("group",i,Se.createElement("group",{ref:o,matrixAutoUpdate:!1},f))});function vo(){const f=Se.useRef();return cr(t=>{f.current.position.z=t.camera.position.z+1-4,f.current.target.position.z=t.camera.position.z-4,f.current.target.updateMatrixWorld()}),X.jsxs(X.Fragment,{children:[X.jsx("directionalLight",{ref:f,castShadow:!0,position:[4,4,1],intensity:4.5,"shadow-mapSize":[1024,1024],"shadow-camera-near":1,"shadow-camera-far":10,"shadow-camera-top":10,"shadow-camera-right":10,"shadow-camera-bottom":-10,"shadow-camera-left":-10}),X.jsx("ambientLight",{intensity:1.5})]})}const He=new aa(1,1,1),Mn=new Jr({color:"limegreen"}),At=new Jr({color:"greenYellow"}),Dt=new Jr({color:"orangered"}),xt=new Jr({color:"slategrey"});function po({position:f=[0,0,0]}){return X.jsxs("group",{position:f,children:[X.jsxs(ho,{floatIntensity:.25,rotationIntensity:.25,children:[X.jsxs(Hr,{scale:.5,font:"/bebas-neue-v9-latin-regular.woff",maxWidth:.25,lineHeight:.75,textAlign:"right",position:[.75,.65,0],"rotation-y":-.25,children:["Marble Rush 3D",X.jsx("meshBasicMaterial",{toneMapped:!1})]}),X.jsxs(Hr,{scale:.13,font:"/bebas-neue-v9-latin-regular.woff",maxWidth:8,lineHeight:.75,textAlign:"left",position:[-1.4,1.1,-.6],"rotation-y":1.4,children:["Finish the course as fast as you can!",X.jsx("meshBasicMaterial",{toneMapped:!1})]}),X.jsxs(Hr,{scale:.13,font:"/bebas-neue-v9-latin-regular.woff",maxWidth:5.5,lineHeight:.75,textAlign:"left",position:[-1.4,.7,-.5],"rotation-y":1.5,children:["5 seconds = 5 XP 6 seconds = 2 XP 7 seconds = 1 XP",X.jsx("meshBasicMaterial",{toneMapped:!1})]})]}),X.jsx("mesh",{geometry:He,material:Mn,position:[0,-.1,0],scale:[4,.2,4],receiveShadow:!0})]})}function go({position:f=[0,0,0]}){const t=fa("/hamburger.glb");return t.scene.children.forEach(d=>{d.castShadow=!0}),X.jsxs("group",{position:f,children:[X.jsxs(Hr,{scale:1,position:[0,2.25,2],children:["FINISH",X.jsx("meshBasicMaterial",{toneMapped:!1})]}),X.jsx("mesh",{geometry:He,material:Mn,position:[0,0,0],scale:[4,.2,4],receiveShadow:!0}),X.jsx(hr,{type:"fixed",cilliders:"hull",position:[0,.25,0],restitution:.2,friction:0,children:X.jsx("primitive",{castShadow:!0,object:t.scene,scale:.2})})]})}function mo({position:f=[0,0,0]}){const t=Se.useRef(),[d]=Se.useState(()=>(Math.random()+.2)*(Math.random()<.5?1:-1));return cr(h=>{const r=h.clock.getElapsedTime(),e=new ta;e.setFromEuler(new na(0,r*d,0)),t.current.setNextKinematicRotation(e)}),X.jsxs("group",{position:f,children:[X.jsx("mesh",{geometry:He,material:At,position:[0,-.1,0],scale:[4,.2,4],receiveShadow:!0}),X.jsx(hr,{ref:t,type:"kinematicPosition",position:[0,.3,0],restitution:.2,friction:0,children:X.jsx("mesh",{geometry:He,material:Dt,scale:[3.5,.3,.3],castShadow:!0,receiveShadow:!0})})]})}function yo({position:f=[0,0,0]}){const t=Se.useRef(),[d]=Se.useState(()=>Math.random()*Math.PI*2);return cr(h=>{const r=h.clock.getElapsedTime(),e=Math.sin(r+d)+1.15;t.current.setNextKinematicTranslation({x:f[0],y:f[1]+e,z:f[2]})}),X.jsxs("group",{position:f,children:[X.jsx("mesh",{geometry:He,material:At,position:[0,-.1,0],scale:[4,.2,4],receiveShadow:!0}),X.jsx(hr,{ref:t,type:"kinematicPosition",position:[0,.3,0],restitution:.2,friction:0,children:X.jsx("mesh",{geometry:He,material:Dt,scale:[3.5,.3,.3],castShadow:!0,receiveShadow:!0})})]})}function bo({position:f=[0,0,0]}){const t=Se.useRef(),[d]=Se.useState(()=>Math.random()*Math.PI*2);return cr(h=>{const r=h.clock.getElapsedTime(),e=Math.sin(r+d)*1.25;t.current.setNextKinematicTranslation({x:f[0]+e,y:f[1]+.75,z:f[2]})}),X.jsxs("group",{position:f,children:[X.jsx("mesh",{geometry:He,material:At,position:[0,-.1,0],scale:[4,.2,4],receiveShadow:!0}),X.jsx(hr,{ref:t,type:"kinematicPosition",position:[0,.3,0],restitution:.2,friction:0,children:X.jsx("mesh",{geometry:He,material:Dt,scale:[1.5,1.5,.3],castShadow:!0,receiveShadow:!0})})]})}function xo({length:f=1}){return X.jsx(X.Fragment,{children:X.jsxs(hr,{type:"fixed",restitution:.2,friction:0,children:[X.jsx("mesh",{position:[2.15,.75,-(f*2)+2],geometry:He,material:xt,scale:[.3,1.5,4*f],castShadow:!0}),X.jsx("mesh",{position:[-2.15,.75,-(f*2)+2],geometry:He,material:xt,scale:[.3,1.5,4*f],receiveShadow:!0}),X.jsx("mesh",{position:[0,.75,-(f*4)+2],geometry:He,material:xt,scale:[4,1.5,.3],receiveShadow:!0}),X.jsx(ua,{args:[2,.1,2*f],position:[0,-.1,-(f*2)+2],restitution:.2,friction:1})]})})}function wo({count:f=10,types:t=[mo,yo,bo],seed:d=0}){const h=Se.useMemo(()=>{const r=[];for(let e=0;e<f;e++){const a=t[Math.floor(Math.random()*t.length)];r.push(a)}return r},[f,t,d]);return X.jsxs(X.Fragment,{children:[X.jsx(po,{position:[0,0,0]}),h.map((r,e)=>X.jsx(r,{position:[0,0,-(e+1)*4]},e)),X.jsx(go,{position:[0,0,-(f+1)*4]}),X.jsx(xo,{length:f+2})]})}const Ne=ca(ha(f=>({blocksCount:10,blockSeed:0,startTime:0,endTime:0,phase:"ready",start:()=>{f(t=>t.phase==="ready"?{phase:"playing",startTime:Date.now()}:{})},restart:()=>{f(t=>t.phase==="playing"||t.phase==="ended"?{phase:"ready",blocksSeed:Math.random()}:{})},end:()=>{f(t=>t.phase==="playing"?{phase:"ended",endTime:Date.now()}:{})}})));function Et(f,t=1,d=!1){const h=new Audio(f);return h.volume=t,h.loop=d,h}const Yr=Et("/audio/background-music.mp3",.3,!0),mn=Et("/audio/hit-sound.mp3",.5),yn=Et("/audio/finish-sound.mp3",.7),So=()=>{mn.currentTime=0,mn.play().catch(f=>console.error("Error playing hit sound:",f))},Uo=()=>{Yr.currentTime=0,Yr.play().catch(f=>console.error("Error playing background music:",f))},wt=()=>{Yr.pause(),Yr.currentTime=0},ko=()=>{yn.currentTime=0,yn.play().catch(f=>console.error("Error playing finish sound:",f))};function _o(){const f=Se.useRef(),[t,d]=nr(),{rapier:h,world:r}=da(),e=r,[a]=Se.useState(()=>new ar),[i]=Se.useState(()=>new ar),n=Ne(p=>p.start),o=Ne(p=>p.end),s=Ne(p=>p.restart),l=Ne(p=>p.blocksCount),u=()=>{const p=f.current.translation();p.y-=.31;const m={x:0,y:-1,z:0},G=new h.Ray(p,m);e.castRay(G,10,!0).timeOfImpact<.15&&f.current.applyImpulse({x:0,y:.5,z:0})},c=p=>{So()},g=()=>{f.current.setTranslation({x:0,y:1,z:0}),f.current.setLinvel({x:0,y:0,z:0}),f.current.setAngvel({x:0,y:0,z:0})};return Se.useEffect(()=>{const p=Ne.subscribe(y=>y.phase,y=>{y==="ready"&&g()}),m=t(y=>y.jump,y=>{y&&u()}),G=t(y=>y.restart,y=>{y&&(wt(),s())}),S=t(y=>[y.forward,y.backward,y.leftward,y.rightward],y=>{y.some(k=>k)&&Ne.getState().phase==="ready"&&n()}),T=Ne.subscribe(y=>y.phase,y=>{y==="playing"?Uo():y==="ended"?(wt(),ko()):wt()});return()=>{m(),p(),G(),T(),S()}}),cr((p,m)=>{const{forward:G,backward:S,leftward:T,rightward:y,restart:k}=d(),R={x:0,y:0,z:0},w={x:0,y:0,z:0},_=.6*m,B=.2*m;G&&(R.z-=_,w.x-=B),y&&(R.x+=_,w.z-=B),S&&(R.z+=_,w.x+=B),T&&(R.x-=_,w.z+=B),f.current.applyImpulse(R),f.current.applyTorqueImpulse(w);const D=f.current.translation(),Y=new ar;Y.copy(D),Y.z+=2.25,Y.y+=.6;const b=new ar;b.copy(D),b.y+=.25,a.lerp(Y,5*m),i.lerp(Y,5*m),p.camera.position.copy(a),p.camera.lookAt(i),D.z<-(l*4+2)&&o(),D.y<-4&&k()}),X.jsx(hr,{ref:f,canSleep:!1,colliders:"ball",restitution:.2,friction:1,linearDamping:.5,angularDamping:.5,position:[0,1,0],onCollisionEnter:c,children:X.jsxs("mesh",{castShadow:!0,children:[X.jsx("icosahedronGeometry",{args:[.3,1]}),X.jsx("meshStandardMaterial",{flatShading:!0,color:"mediumpurple"})]})})}function To(){const f=Ne(d=>d.blocksCount),t=Ne(d=>d.blocksSeed);return X.jsxs(X.Fragment,{children:[X.jsx("color",{args:["#bdedfc"],attach:"background"}),X.jsxs(va,{children:[X.jsx(vo,{}),X.jsx(wo,{count:f,seed:t}),X.jsx(_o,{})]})]})}const Fo=async({gameSlug:f,time:t,xp:d})=>{var h;try{return(await oa.post("/gameplay/submitGameResult",{game_slug:f,time_ms:t,xp:d})).data}catch(r){throw((h=r.response)==null?void 0:h.data)||new Error("An unknown error occurred.")}},Co=f=>f<5e3?5:f<6e3?2:f<7e3?1:0;function Ao(){const f=Se.useRef(),t=Ne(l=>l.restart),d=Ne(l=>l.phase),h=nr(l=>l.forward),r=nr(l=>l.backward),e=nr(l=>l.leftward),a=nr(l=>l.rightward),i=nr(l=>l.jump),n=nr(l=>l.restart),o=Se.useRef(!1),{mutate:s}=ga({mutationFn:Fo,onSuccess:()=>{sa.success("Result submitted successfully!")},onError:l=>{}});return Se.useEffect(()=>{const l=ia(()=>{const u=Ne.getState();let c=0;if(u.phase==="playing")c=Date.now()-u.startTime;else if(u.phase==="ended"){c=u.endTime-u.startTime;const g=Co(c);o.current||(o.current=!0,s({gameSlug:"marble-rush-3d",time:c,xp:g}))}c/=1e3,c=c.toFixed(2),f.current&&(f.current.textContent=c)});return()=>l()},[]),Se.useEffect(()=>{d==="playing"&&(o.current=!1)},[d]),X.jsxs("div",{className:"interface",children:[X.jsx("div",{ref:f,className:"time",children:"0.00"}),d==="ended"&&X.jsx("div",{className:"restart",onClick:t,children:"Restart"}),X.jsx("div",{className:"interface",children:X.jsxs("div",{className:"controls",children:[X.jsxs("div",{className:"raw",children:[X.jsx("div",{className:`key ${h?"active":""}`}),X.jsx("div",{className:`key ${n?"active":""}`,children:"R"})]}),X.jsxs("div",{className:"raw",children:[X.jsx("div",{className:`key ${e?"active":""}`}),X.jsx("div",{className:`key ${r?"active":""}`}),X.jsx("div",{className:`key ${a?"active":""}`})]}),X.jsx("div",{className:"raw",children:X.jsx("div",{className:`key large ${i?"active":""}`})})]})})]})}function Go(){return X.jsx("div",{style:{height:"100vh",width:"100vw"},children:X.jsxs(pa,{map:[{name:"forward",keys:["ArrowUp","KeyW"]},{name:"backward",keys:["ArrowDown","KeyS"]},{name:"leftward",keys:["ArrowLeft","KeyA"]},{name:"rightward",keys:["ArrowRight","KeyD"]},{name:"jump",keys:["Space"]},{name:"restart",keys:["KeyR"]}],children:[X.jsx(la,{shadows:!0,camera:{fov:45,near:.1,far:200,position:[2.5,4,6]},children:X.jsx(To,{})}),X.jsx(Ao,{})]})})}export{Go as default};
